!function(){"use strict";var e,t,r,n,i,s,a,u,o={d:function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},c={};o.r(c),o.d(c,{Archive:function(){return M},ArchiveEntry:function(){return E},ArchiveEntryAsyncContentIterator:function(){return h},ArchiveReadError:function(){return p},ArchiveReader:function(){return T},ArchiveWriter:function(){return L},AsyncUint8ArrayIterator:function(){return y},Constants:function(){return e},GnuHeader:function(){return I},InMemoryAsyncUint8Array:function(){return A},PaxHeader:function(){return d},PaxHeaderKey:function(){return i},PaxHeaderSegment:function(){return l},TarHeader:function(){return g},TarHeaderUtility:function(){return u},TarUtility:function(){return t},UstarHeader:function(){return m},UstarHeaderField:function(){return f},UstarHeaderFieldTransformType:function(){return n},UstarHeaderFieldType:function(){return r},UstarHeaderLinkIndicatorType:function(){return a}});class h{entry;constructor(e){this.entry=e}[Symbol.asyncIterator](){return this}async next(){const e=await this.entry.readNextContentChunk();return null!==e?{done:!1,value:e}:{done:!0,value:null}}}!function(e){e.SECTOR_SIZE=512,e.OCTAL_RADIX=8,e.USTAR_TAG="ustar",e.USTAR_INDICATOR_VALUE=`${e.USTAR_TAG}\0`,e.GNU_INDICATOR_VALUE=`${e.USTAR_TAG} `,e.USTAR_VERSION_VALUE="00",e.HEADER_SIZE=e.SECTOR_SIZE,e.FILE_MODE_DEFAULT=511,e.TERMINAL_PADDING_SIZE=2*e.SECTOR_SIZE,e.PAX_HEADER_PREFIX="PaxHeader",e.GNU_LONG_LINK_FILE_NAME="././@LongLink"}(e||(e={})),function(t){function r(e){return"number"==typeof e&&!Number.isNaN(e)}function n(e){return"string"==typeof e}function i(e){return void 0===e}function s(e){return n(e)&&e.length>0}function a(e){return!!(e&&e instanceof Uint8Array)}function u(t){return(1+Math.floor(t/e.SECTOR_SIZE))*e.SECTOR_SIZE}function o(t){return Math.ceil(t/e.SECTOR_SIZE)*e.SECTOR_SIZE}function c(e){return Math.floor(l(e)/1e3)}function h(e){return 1e3*Math.floor(l(e))}function f(e){return h(c(e))}function l(e,t=10,n=0){if(r(e))return Math.floor(e);const i=parseInt(e,t);return r(i)?i:n}t.isNumber=r,t.isString=n,t.isUndefined=i,t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDefined=function(e){return!i(e)},t.isPopulatedString=s,t.isUint8Array=a,t.sizeofUint8Array=function(e){return a(e)?e.byteLength:0},t.encodeString=function(e){return s(e)?(new TextEncoder).encode(e):new Uint8Array(0)},t.decodeString=function(e){return a(e)?(new TextDecoder).decode(e):""},t.generateChecksum=function(e){return a(e)?e.reduce((e,t)=>e+t,0):0},t.clamp=function(e,t,r){return Math.max(t,Math.min(e,r))},t.advanceSectorOffset=function(e,t){return Math.min(t,u(e))},t.advanceSectorOffsetUnclamped=u,t.roundUpSectorOffset=o,t.getSectorOffsetDelta=function(e){return o(e)-e},t.parseIntOctal=function(t){return l(t,e.OCTAL_RADIX)},t.dateTimeToUstar=c,t.ustarTimeToDate=h,t.sanitizeDateTimeAsUstar=f,t.getUstarTimestamp=function(){return f(Date.now())},t.paxTimeToDate=function(e){return Math.floor(1e3*e)},t.paxTimeToUstar=function(e){return Math.floor(e)},t.getDebugHexString=function(e){return a(e)?Array.from(e).map(e=>e.toString(16).padStart(2,"0").toUpperCase()).join(" "):""},t.getDebugBufferJson=function(e){return{byteLength:e?.byteLength??0,content:t.getDebugHexString(e)}},t.removeTrailingZeros=function(e){const t=/^([^\0]*)[\0]*$/.exec(e);return t?t[1]:e},t.parseIntSafe=l,t.parseFloatSafe=function(e,t=0){if(r(e))return e;const n=parseFloat(e);return r(n)?n:t},t.cloneUint8Array=function(e,t,r){if(!a(e))return new Uint8Array(0);const n=e.slice(t,r),i=Array.from(n);return Uint8Array.from(i)},t.concatUint8Arrays=function(e,t){if(!a(t))return e;if(!a(e))return t;const r=e.byteLength,n=t.byteLength,i=new Uint8Array(r+n);return r>0&&i.set(e,0),n>0&&i.set(t,r),i}}(t||(t={})),function(e){e.ASCII="ASCII",e.ASCII_PADDED_END="ASCII_PADDED_END",e.INTEGER_OCTAL="INTEGER_OCTAL",e.INTEGER_OCTAL_TIMESTAMP="INTEGER_OCTAL_TIMESTAMP"}(r||(r={})),function(n){function i(r,n,i){const s=function(r,n){return t.parseIntSafe(r).toString(e.OCTAL_RADIX).padStart(n,"0").substring(0,n)}(r,Math.max(0,n-1-i.length))+i;return t.encodeString(s)}function s(e,t,r){return e.slice(r,r+t)}function a(r,n,i){const a=s(r,n,i);return t.parseIntSafe(t.decodeString(a).trim(),e.OCTAL_RADIX)}n.ASCII=Object.freeze({serialize:function(e,r){return t.encodeString(String(e).substring(0,r))},deserialize:function(e,r,n){const i=s(e,r,n);return t.decodeString(i)}}),n.ASCII_PADDED_END=Object.freeze({serialize:function(e,r){return(e=String(e)).length>r?t.encodeString(e.substring(0,r-1)+"\0"):t.encodeString(e.padEnd(r,"\0"))},deserialize:function(e,r,n){const i=s(e,r,n);return t.removeTrailingZeros(t.decodeString(i))}}),n.INTEGER_OCTAL=Object.freeze({serialize:function(e,t){return i(e,t," ")},deserialize:a}),n.INTEGER_OCTAL_TIMESTAMP=Object.freeze({serialize:function(e,r){return i(t.dateTimeToUstar(e),r,"")},deserialize:function(e,r,n){return t.ustarTimeToDate(a(e,r,n))}}),n.from=function(e){switch(e){case r.ASCII:return n.ASCII;case r.ASCII_PADDED_END:return n.ASCII_PADDED_END;case r.INTEGER_OCTAL:return n.INTEGER_OCTAL;case r.INTEGER_OCTAL_TIMESTAMP:return n.INTEGER_OCTAL_TIMESTAMP;default:return}}}(n||(n={}));class f{name;offset;size;type;constantValue;transform;constructor(e){this.name=e.name,this.offset=e.offset,this.size=e.size,this.type=e.type,this.constantValue=e.constantValue||void 0,this.transform=n.from(this.type)}static frozen(e){return Object.freeze(new f(e))}static fileName=f.frozen({name:"fileName",offset:0,size:100,type:r.ASCII_PADDED_END});static fileMode=f.frozen({name:"fileMode",offset:100,size:8,type:r.INTEGER_OCTAL});static ownerUserId=f.frozen({name:"ownerUserId",offset:108,size:8,type:r.INTEGER_OCTAL});static groupUserId=f.frozen({name:"groupUserId",offset:116,size:8,type:r.INTEGER_OCTAL});static fileSize=f.frozen({name:"fileSize",offset:124,size:12,type:r.INTEGER_OCTAL});static lastModified=f.frozen({name:"lastModified",offset:136,size:12,type:r.INTEGER_OCTAL_TIMESTAMP});static headerChecksum=f.frozen({name:"headerChecksum",offset:148,size:8,type:r.INTEGER_OCTAL});static typeFlag=f.frozen({name:"typeFlag",offset:156,size:1,type:r.ASCII});static linkedFileName=f.frozen({name:"linkedFileName",offset:157,size:100,type:r.ASCII_PADDED_END});static ustarIndicator=f.frozen({name:"ustarIndicator",offset:257,size:6,type:r.ASCII,constantValue:e.USTAR_INDICATOR_VALUE});static ustarVersion=f.frozen({name:"ustarVersion",offset:263,size:2,type:r.ASCII,constantValue:e.USTAR_VERSION_VALUE});static ownerUserName=f.frozen({name:"ownerUserName",offset:265,size:32,type:r.ASCII_PADDED_END});static ownerGroupName=f.frozen({name:"ownerGroupName",offset:297,size:32,type:r.ASCII_PADDED_END});static deviceMajorNumber=f.frozen({name:"deviceMajorNumber",offset:329,size:8,type:r.ASCII_PADDED_END});static deviceMinorNumber=f.frozen({name:"deviceMinorNumber",offset:337,size:8,type:r.ASCII_PADDED_END});static fileNamePrefix=f.frozen({name:"fileNamePrefix",offset:345,size:155,type:r.ASCII_PADDED_END});static all(){return[f.fileName,f.fileMode,f.ownerUserId,f.groupUserId,f.fileSize,f.lastModified,f.headerChecksum,f.typeFlag,f.linkedFileName,f.ustarIndicator,f.ustarVersion,f.ownerUserName,f.ownerGroupName,f.deviceMajorNumber,f.deviceMinorNumber,f.fileNamePrefix]}static checksumSet(){return f.all().filter(e=>e!==f.headerChecksum)}sliceString(e,r){return t.decodeString(this.slice(e,r))}slice(e,r=0){if(!t.isUint8Array(e))return new Uint8Array(0);const n=r+this.offset,i=n+this.size;return e.slice(n,i)}deserialize(e,r=0){if(t.isUint8Array(e))return this.transform.deserialize(e,this.size,r)}serialize(e){const t=new Uint8Array(this.size),r=this.transform.serialize(e,this.size);return t.set(r,0),t}readFrom(e,t){return this.deserialize(e,t+this.offset)}writeTo(e,r,n){r=Math.max(r,0);const i=this.serialize(n),s=i.byteLength,a=r+this.offset;return!!(s>0&&t.isUint8Array(e)&&e.byteLength>=a+s)&&(e.set(i,a),!0)}calculateChecksum(e,r=0){let n=0;if(!t.isUint8Array(e))return n;const i=r+this.offset,s=i+this.size;for(let t=i;t<s;t++)n+=e[t];return n}}!function(e){e.ACCESS_TIME="atime",e.CHARSET="charset",e.COMMENT="comment",e.GROUP_ID="gid",e.GROUP_NAME="gname",e.HDR_CHARSET="hdrcharset",e.LINK_PATH="linkpath",e.MODIFICATION_TIME="mtime",e.PATH="path",e.SIZE="size",e.USER_ID="uid",e.USER_NAME="uname"}(i||(i={}));class l{mKey;mValue;mBytes;constructor(e="",t="",r=null){this.mKey=e,this.mValue=t,this.mBytes=r}static serialize(e,r){if(!e||!r)return new Uint8Array(0);const n=` ${e}=${r}\n`,i=n.length.toString().length;let s=n.length+i;s<s.toString().length+n.length&&(s+=1);const a=s.toString()+n;return t.encodeString(a)}static deserialize(e,r=0){if(!t.isUint8Array(e))return null;const n=l.findNextLengthEndIndex(e,r);if(n<0)return null;const i=t.decodeString(e.slice(r,n)),s=parseInt(i,10);if(isNaN(s))return null;const a=n+1,u=r+s,o=t.decodeString(e.slice(a,u)),c=o.indexOf("="),h=o.substring(0,c),f=o.substring(c+1).replace(/\n$/,""),d=t.cloneUint8Array(e,r,r+s);return new l(h,f,d)}static findNextLengthEndIndex(e,t){let r=t+1;for(;r<e.byteLength;){if(32===e[r])return r;r+=1}return-1}get key(){return this.mKey}get value(){return this.mValue}get bytes(){return this.toUint8Array()}get intValue(){const e=parseInt(this.value);return isNaN(e)?void 0:e}get floatValue(){const e=parseFloat(this.value);return isNaN(e)?void 0:e}toUint8Array(){return t.isUint8Array(this.mBytes)||(this.mBytes=l.serialize(this.key,this.value)),this.mBytes}toJSON(){const{key:e,value:r,bytes:n}=this;return{key:e,value:r,content:t.getDebugHexString(n)}}}!function(e){const t=[i.COMMENT,i.GROUP_ID,i.GROUP_NAME,i.HDR_CHARSET,i.LINK_PATH,i.MODIFICATION_TIME,i.PATH,i.SIZE,i.USER_ID,i.USER_NAME];e.isKnownHeaderKey=function(e){return t.includes(e)}}(s||(s={}));class d{valueMap;constructor(e=[]){this.valueMap={};for(const t of e)this.valueMap[t.key]=t}static deserialize(e,t=0){const r=d.deserializeSegments(e,t);return new d(r)}static fromAttributes(e){const t=d.parseSegmentsFromAttributes(e);return new d(t)}static serializeAttributes(e){const t=d.parseSegmentsFromAttributes(e);return d.serializeSegments(t)}static parseSegmentsFromAttributes(e){if(!t.isObject(e))return[];const r=[];for(const[n,i]of Object.entries(e)){const e=t.isString(i)?i:String(i);r.push(new l(n,e))}return r}static serializeSegments(e){if(!Array.isArray(e)||e.length<=0)return new Uint8Array(0);let t=0,r=[];for(const n of e){const e=n.toUint8Array();r.push(e),t+=e.byteLength}const n=new Uint8Array(t);let i=0;for(const e of r)n.set(e,i),i+=e.byteLength;return n}static wrapFileName(r){if(!t.isString(r)||r.includes(e.PAX_HEADER_PREFIX))return r;let n=r.lastIndexOf("/");return n>=0?d.insertPaxAt(r,"/",n):(n=r.lastIndexOf("\\"),n>=0?d.insertPaxAt(r,"\\",n):d.makeTopLevelPrefix(r,"/",0))}static insertPaxAt(t,r,n){const i=f.fileName.size;return t.length<i?t.substring(0,n)+r+e.PAX_HEADER_PREFIX+t.substring(n):d.makeTopLevelPrefix(t,"/",n+1)}static makeTopLevelPrefix(t,r,n){const i=f.fileName.size;let s=e.PAX_HEADER_PREFIX+r+t.substring(n);return s.length>i&&(s=s.substring(0,i-2)+"\0\0"),s}static deserializeSegments(e,t){const r=[];let n=t,i=l.deserialize(e,n);for(;null!==i;)r.push(i),n+=i.bytes.byteLength,i=l.deserialize(e,n);return r}get accessTime(){return this.getFloat(i.ACCESS_TIME)}get charset(){return this.get(i.CHARSET)}get comment(){return this.get(i.COMMENT)}get groupId(){return this.getInt(i.GROUP_ID)}get groupName(){return this.get(i.GROUP_NAME)}get hdrCharset(){return this.get(i.HDR_CHARSET)}get linkPath(){return this.get(i.LINK_PATH)}get modificationTime(){return this.getFloat(i.MODIFICATION_TIME)}get path(){return this.get(i.PATH)}get size(){return this.getInt(i.SIZE)}get userId(){return this.getInt(i.USER_ID)}get userName(){return this.get(i.USER_NAME)}get lastModified(){const e=this.modificationTime;return e?t.paxTimeToDate(e):void 0}keys(){return Object.keys(this.valueMap)}values(){return Object.values(this.valueMap)}clean(){for(const e of this.keys())s.isKnownHeaderKey(e)||delete this.valueMap[e];return this}has(e){return t.isDefined(this.valueMap[e])}get(e){return this.valueMap[e]?.value}getInt(e){return this.valueMap[e]?.intValue}getFloat(e){return this.valueMap[e]?.floatValue}toUint8Array(){return d.serializeSegments(this.values())}toUint8ArrayPadded(){const e=this.toUint8Array();let r=t.getSectorOffsetDelta(e.byteLength);return r>0?t.concatUint8Arrays(e,new Uint8Array(r)):e}toJSON(){const{valueMap:e}=this,r=this.toUint8Array();return{attributes:e,buffer:t.getDebugBufferJson(r)}}}!function(e){e.UNKNOWN="UNKNOWN",e.NORMAL_FILE="0",e.NORMAL_FILE_ALT1="\0",e.NORMAL_FILE_ALT2="",e.HARD_LINK="1",e.SYMBOLIC_LINK="2",e.CHARACTER_SPECIAL="3",e.BLOCK_SPECIAL="4",e.DIRECTORY="5",e.FIFO="6",e.CONTIGUOUS_FILE="7",e.GLOBAL_EXTENDED_HEADER="g",e.LOCAL_EXTENDED_HEADER="x",e.GNU_LONG_LINK_PATH_HEADER="K",e.GNU_LONG_PATH_HEADER="L",e.GNU_LONG_PATH_HEADER_ALT1="N"}(a||(a={})),function(r){function n(t,r){return f.ustarIndicator.sliceString(t,r).startsWith(e.USTAR_TAG)}r.CHECKSUM_SEED_STRING="".padStart(f.headerChecksum.size," "),r.CHECKSUM_SEED=t.generateChecksum(t.encodeString(r.CHECKSUM_SEED_STRING)),r.ALL_FIELDS=f.all(),r.CHECKSUM_FIELDS=f.checksumSet(),r.isUstarSector=n,r.isTarHeaderLinkIndicatorTypeDirectory=function(e){return e===a.DIRECTORY},r.isTarHeaderLinkIndicatorTypeFile=function(e){switch(e){case a.NORMAL_FILE:case a.NORMAL_FILE_ALT1:case a.NORMAL_FILE_ALT2:case a.CONTIGUOUS_FILE:return!0;default:return!1}},r.isTarHeaderLinkIndicatorTypePax=function(e){switch(e){case a.LOCAL_EXTENDED_HEADER:case a.GLOBAL_EXTENDED_HEADER:return!0;default:return!1}},r.findNextUstarSectorOffset=function(e,r=0){if(!t.isUint8Array(e))return-1;const i=e.byteLength;let s=Math.max(0,r);for(;s<i&&!n(e,s);)s=t.advanceSectorOffset(s,i);return s<i?s:-1}}(u||(u={}));class m{mValueMap=m.defaultValues();constructor(e={}){this.update(e)}static isUstarHeader(e){return!!(e&&e instanceof m)}static fromAttributes(e){return m.isUstarHeader(e)?e:new m(e)}static serializeAttributes(e){return m.fromAttributes(e).toUint8Array()}static deserialize(e,t=0){if(!u.isUstarSector(e,t))return null;const r={};for(const n of u.ALL_FIELDS)r[n.name]=n.readFrom(e,t);return new m(r)}static defaultValues(){return{fileName:"",fileMode:e.FILE_MODE_DEFAULT,groupUserId:0,ownerUserId:0,fileSize:0,lastModified:t.getUstarTimestamp(),headerChecksum:0,linkedFileName:"",typeFlag:a.NORMAL_FILE,ustarIndicator:e.USTAR_INDICATOR_VALUE,ustarVersion:e.USTAR_VERSION_VALUE,ownerUserName:"",ownerGroupName:"",deviceMajorNumber:"00",deviceMinorNumber:"00",fileNamePrefix:""}}get fileName(){return this.mValueMap.fileName}set fileName(e){this.mValueMap.fileName=e}get fileMode(){return this.mValueMap.fileMode}set fileMode(e){this.mValueMap.fileMode=e}get ownerUserId(){return this.mValueMap.ownerUserId}set ownerUserId(e){this.mValueMap.ownerUserId=e}get groupUserId(){return this.mValueMap.groupUserId}set groupUserId(e){this.mValueMap.groupUserId=e}get fileSize(){return this.mValueMap.fileSize}set fileSize(e){this.mValueMap.fileSize=e}get lastModified(){return this.mValueMap.lastModified}set lastModified(e){this.mValueMap.lastModified=t.sanitizeDateTimeAsUstar(e)}get headerChecksum(){return this.mValueMap.headerChecksum}set headerChecksum(e){this.mValueMap.headerChecksum=e}get linkedFileName(){return this.mValueMap.linkedFileName}set linkedFileName(e){this.mValueMap.linkedFileName=e}get typeFlag(){return this.mValueMap.typeFlag}set typeFlag(e){this.mValueMap.typeFlag=e}get ustarIndicator(){return this.mValueMap.ustarIndicator}get ustarVersion(){return this.mValueMap.ustarVersion}set ustarVersion(e){this.mValueMap.ustarVersion=e}get ownerUserName(){return this.mValueMap.ownerUserName}set ownerUserName(e){this.mValueMap.ownerUserName=e}get ownerGroupName(){return this.mValueMap.ownerGroupName}set ownerGroupName(e){this.mValueMap.ownerGroupName=e}get deviceMajorNumber(){return this.mValueMap.deviceMajorNumber}set deviceMajorNumber(e){this.mValueMap.deviceMajorNumber=e}get deviceMinorNumber(){return this.mValueMap.deviceMinorNumber}set deviceMinorNumber(e){this.mValueMap.deviceMinorNumber=e}get fileNamePrefix(){return this.mValueMap.fileNamePrefix}set fileNamePrefix(e){this.mValueMap.fileNamePrefix=e}get isFileHeader(){return u.isTarHeaderLinkIndicatorTypeFile(this.typeFlag)}get isDirectoryHeader(){return u.isTarHeaderLinkIndicatorTypeDirectory(this.typeFlag)}get isPaxHeader(){return this.isLocalPaxHeader||this.isGlobalPaxHeader}get isGlobalPaxHeader(){return this.typeFlag===a.GLOBAL_EXTENDED_HEADER}get isLocalPaxHeader(){return this.typeFlag===a.LOCAL_EXTENDED_HEADER}get isGnuLongHeader(){return this.isGnuLongLinkPathHeader||this.isGnuLongPathHeader}get isGnuLongLinkPathHeader(){return this.typeFlag===a.GNU_LONG_LINK_PATH_HEADER}get isGnuLongPathHeader(){return this.typeFlag===a.GNU_LONG_PATH_HEADER||this.typeFlag===a.GNU_LONG_PATH_HEADER_ALT1}update(e){return Object.assign(this.mValueMap,e),this}toAttributes(){return Object.assign({},this.mValueMap)}toUint8Array(){const t=new Uint8Array(e.HEADER_SIZE);let r=u.CHECKSUM_SEED;for(const e of u.CHECKSUM_FIELDS)e.writeTo(t,0,this.mValueMap[e.name]),r+=e.calculateChecksum(t);return this.headerChecksum=r,f.headerChecksum.writeTo(t,0,r),t}toJSON(){const e=this.toAttributes(),r=this.toUint8Array();return{attributes:e,buffer:t.getDebugBufferJson(r)}}}class g{ustar;pax;gnu;mPreamble;mIsGlobal;constructor(e){const{ustar:t,pax:r,gnu:n,preamble:i,isPaxGlobal:s}=e;this.ustar=t,this.pax=r,this.gnu=n,this.mPreamble=i,this.mIsGlobal=!!s,this.trySyncPaxHeader()}static isTarHeader(e){return!!(e&&e instanceof g)}static fromAttributes(e){if(g.isTarHeader(e))return e;const t=new m(e),r=g.collectPaxRequiredAttributes(e);let n;if(r){const[e,i]=g.splitBaseFileName(r.path);t.fileName=i,t.fileNamePrefix=e,n=d.fromAttributes(r)}return new g({ustar:t,pax:n})}static serializeAttributes(e){return g.isTarHeader(e)?e.toUint8Array():g.fromAttributes(e).toUint8Array()}static collectPaxRequiredAttributes(e){if(t.isObject(e)){let t={};if(e.fileName&&e.fileName.length>f.fileName.size&&(t.path=e.fileName),Object.keys(t).length>0)return t}return null}static splitBaseFileName(e){let t=e.lastIndexOf("/");return t>=0?[e.substring(0,t),e.substring(t+1)]:(t=e.lastIndexOf("\\"),t>=0?[e.substring(0,t),e.substring(t+1)]:["",e])}get preamble(){return this.mPreamble}get fileName(){return this.pax?.path||this.gnu?.longPath||this.ustar.fileName}get fileMode(){return this.ustar.fileMode}get ownerUserId(){return this.pax?.userId||this.ustar.ownerUserId}get groupUserId(){return this.pax?.groupId||this.ustar.groupUserId}get fileSize(){return this.pax?.size||this.ustar.fileSize}get lastModified(){return this.pax?.lastModified||this.ustar.lastModified}get headerChecksum(){return this.ustar.headerChecksum}get linkedFileName(){return this.pax?.linkPath||this.gnu?.longLinkPath||this.ustar.linkedFileName}get typeFlag(){return this.ustar.typeFlag}get ustarIndicator(){return this.ustar.ustarIndicator}get ustarVersion(){return this.ustar.ustarVersion}get ownerUserName(){return this.pax?.userName||this.ustar.ownerUserName}get ownerGroupName(){return this.pax?.groupName||this.ustar.ownerGroupName}get deviceMajorNumber(){return this.ustar.deviceMajorNumber}get deviceMinorNumber(){return this.ustar.deviceMinorNumber}get fileNamePrefix(){return this.ustar.fileNamePrefix}get isFileHeader(){return this.ustar.isFileHeader}get isDirectoryHeader(){return this.ustar.isDirectoryHeader}get isPaxHeader(){return this.isLocalPaxHeader||this.isGlobalPaxHeader}get isGlobalPaxHeader(){return this.isGlobalPaxPreHeader||this.isGlobalPaxPostHeader}get isLocalPaxHeader(){return this.isLocalPaxPreHeader||this.isLocalPaxPostHeader}get isGlobalPaxPreHeader(){return this.ustar.isGlobalPaxHeader}get isLocalPaxPreHeader(){return this.ustar.isLocalPaxHeader}get isGlobalPaxPostHeader(){return this.preamble?.isGlobalPaxHeader??!1}get isLocalPaxPostHeader(){return this.preamble?.isLocalPaxHeader??!1}get isGnuLongPathHeader(){return this.isGnuLongPathPreHeader||this.isGnuLongPathPostHeader}get isGnuLongLinkPathHeader(){return this.isGnuLongLinkPathPreHeader||this.isGnuLongLinkPathPostHeader}get isGnuLongPathPreHeader(){return this.ustar.isGnuLongPathHeader}get isGnuLongLinkPathPreHeader(){return this.ustar.isGnuLongLinkPathHeader}get isGnuLongPathPostHeader(){return this.preamble?.isGnuLongPathHeader??!1}get isGnuLongLinkPathPostHeader(){return this.preamble?.isGnuLongLinkPathHeader??!1}clean(){return this.pax?.clean(),this}normalize(){return this.trySyncPaxHeader(),this}toUint8Array(){if(this.normalize(),!(this.isPaxHeader&&this.pax&&this.preamble))return this.ustar.toUint8Array();const e=this.preamble.toUint8Array(),t=this.pax.toUint8ArrayPadded(),r=this.ustar.toUint8Array(),n=e.byteLength+t.byteLength+r.byteLength,i=new Uint8Array(n);let s=0;return i.set(e,s),s+=e.byteLength,i.set(t,s),s+=t.byteLength,i.set(r,s),i}toJSON(){const{pax:e,preamble:t,gnu:r,ustar:n}=this;return{preamble:t,pax:e,gnu:r,ustar:n}}trySyncPaxHeader(){if(!this.pax)return;const e=this.fileName,t=this.pax.toUint8Array().byteLength,r=this.pax.lastModified,n={fileName:e,typeFlag:this.mIsGlobal?a.GLOBAL_EXTENDED_HEADER:a.LOCAL_EXTENDED_HEADER,lastModified:r,fileSize:t};this.mPreamble?this.mPreamble.update(n):this.mPreamble=new m(n)}}class E{mHeader;mHeaderByteLength;mContent;mOffset;mContext;constructor(e={}){let{header:r,headerAttributes:n,headerByteLength:i,content:s,offset:a,context:u}=e;r||(r=g.fromAttributes(n||{})),s||(s=null),a||(a=0),u||(u=null);const o=t.sizeofUint8Array(s);!r.pax&&r.fileSize!==o&&o>0&&(r.ustar.fileSize=o),i||(i=r.toUint8Array().byteLength),this.mHeader=r,this.mHeaderByteLength=i,this.mContent=s,this.mOffset=a,this.mContext=u}static isArchiveEntry(e){return!!(e&&e instanceof E)}get fileName(){return this.header.fileName}get fileSize(){return this.header.fileSize}get fileMode(){return this.header.fileMode}get ownerUserId(){return this.header.ownerUserId}get groupUserId(){return this.header.groupUserId}get lastModified(){return this.header.lastModified}get headerChecksum(){return this.header.headerChecksum}get linkedFileName(){return this.header.linkedFileName}get typeFlag(){return this.header.typeFlag}get ustarIndicator(){return this.header.ustarIndicator}get ustarVersion(){return this.header.ustarVersion}get ownerUserName(){return this.header.ownerUserName}get ownerGroupName(){return this.header.ownerGroupName}get deviceMajorNumber(){return this.header.deviceMajorNumber}get deviceMinorNumber(){return this.header.deviceMinorNumber}get fileNamePrefix(){return this.header.fileNamePrefix}get header(){return this.mHeader}get content(){return this.mContent}get sourceOffset(){return this.mOffset}get sourceHeaderByteLength(){return this.mHeaderByteLength}get sourceContext(){return this.mContext}isDirectory(){return this.header.isDirectoryHeader}isFile(){return this.header.isFileHeader}text(){return t.decodeString(this.content)}getContentChunks(){return new h(this)}async readNextContentChunk(){return this.sourceContext?.tryLoadNextEntryContentChunk(this)??null}async readContentFrom(e,r=0,n=0){const i=this.fileSize,s=this.sourceOffset+this.sourceHeaderByteLength,a=s+i,u=s+t.clamp(r,0,i),o=Math.max(0,a-u),c=n>0?Math.min(n,o):o;return e.read(u,c)}toUint8Array(){const e=this.header.toUint8Array(),r=this.content?.byteLength??0,n=t.roundUpSectorOffset(e.byteLength+r),i=new Uint8Array(n);return i.set(e,0),r>0&&i.set(this.content,e.byteLength),i}toJSON(){const{header:e,fileName:r,fileSize:n,content:i,sourceOffset:s,sourceHeaderByteLength:a}=this,u=this.isFile(),o=this.isDirectory();return{name:r,size:n,type:u?"file":o?"directory":"complex",offset:s,byteLength:a+n,header:e,contentType:i?"Uint8Array["+i.byteLength+"]":"null",content:t.getDebugHexString(i)}}}class A{input;constructor(e){this.input=e}get byteLength(){return this.input.byteLength}read(e,t){const r=this.input.byteLength,n=Math.min(e,r),i=Math.min(n+t,r);return Promise.resolve(this.input.slice(n,i))}}const N=e.SECTOR_SIZE,_=1e4*e.SECTOR_SIZE*4;class y{mInput;blockSize;mOffset=0;constructor(e,r={}){this.mInput=t.isUint8Array(e)?new A(e):e;let{blockSize:n}=function(e){return Object.assign({blockSize:_/2},e)}(r);n=t.clamp(n,N,_),n=t.roundUpSectorOffset(n),this.blockSize=n}[Symbol.asyncIterator](){return this}get input(){return this.mInput}get byteLength(){return this.mInput.byteLength}get currentOffset(){return this.mOffset}async tryNext(){const e=await this.next();return e?.value?.buffer??null}async next(){const e=this.input,t=this.currentOffset,r=this.byteLength;if(t>=r)return{done:!0,value:null};const n=Math.min(this.blockSize,r-t),i=await e.read(t,n);return this.mOffset+=i.byteLength,{done:!1,value:{source:e,buffer:i,offset:t}}}}class I{longPath;longLinkPath;constructor(e){this.longPath=e.longPath,this.longLinkPath=e.longLinkPath}}const S=1e5*e.SECTOR_SIZE;var p;!function(e){e.ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET="ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET="ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_HEADER_MISSING_POST_PAX_SEGMENT="ERR_HEADER_MISSING_POST_PAX_SEGMENT",e.ERR_MIN_BUFFER_LENGTH_NOT_MET="ERR_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_MISSING_HEADER_SEGMENT="ERR_MISSING_HEADER_SEGMENT"}(p||(p={}));class T{bufferIterator;mGlobalPaxHeaders=[];mBufferCache=null;mOffset=0;mHasSyncInput;constructor(e){this.bufferIterator=e,this.mHasSyncInput=this.bufferIterator.input instanceof A}static withInput(e,t){return new T(new y(e,t))}[Symbol.asyncIterator](){return this}get source(){return this.bufferIterator.input}get globalPaxHeaders(){return this.mGlobalPaxHeaders}async readAllEntries(){const e=[];for await(const t of this)e.push(t);return e}async next(){const e=await this.tryParseNextEntry();return null!==e?{done:!1,value:e}:{done:!0,value:null}}async tryLoadNextEntryContentChunk(e){if(e.sourceContext!==this||e.header.fileSize<=0)return null;const t=this.bufferIterator.currentOffset,r=e.sourceOffset+e.sourceHeaderByteLength,n=r+e.header.fileSize;if(t<r||t>=n)return null;this.mBufferCache||await this.loadNextChunk();const i=Math.max(0,n-t);let s=this.mBufferCache.slice(this.mOffset);return i<s.byteLength?(s=s.slice(0,i),this.mBufferCache=this.mBufferCache.slice(this.mOffset+i),this.mOffset=0):this.clearBufferCache(),s}clearBufferCache(){this.mBufferCache=null,this.mOffset=0}getBufferCacheSlice(e,r){return t.cloneUint8Array(this.mBufferCache,e,r)}async tryRequireBufferSize(e){return null!==await this.requireBufferSize(e)}async requireBufferSize(e){for(;!this.mBufferCache||this.mBufferCache.byteLength<e;)if(!await this.loadNextChunk())return this.clearBufferCache(),null;return this.mBufferCache}async loadNextChunk(){const e=await this.bufferIterator.tryNext();return!!e&&(this.mBufferCache?this.mBufferCache=t.concatUint8Arrays(this.mBufferCache,e):(this.mBufferCache=e,this.mOffset=0),!0)}async tryParseNextEntry(){const r=await this.tryParseNextHeader();if(null===r)return this.clearBufferCache(),null;const n=this.bufferIterator.currentOffset-this.mBufferCache.byteLength,{header:i,headerOffset:s,contentOffset:a}=r,u=a-s,o=a+i.fileSize,c=s+n,h=t.roundUpSectorOffset(o);let f=null;if(this.mHasSyncInput&&i.fileSize>0){if(!await this.tryRequireBufferSize(h))throw p.ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET;f=this.getBufferCacheSlice(a,o)}return h+e.SECTOR_SIZE<=this.mBufferCache.byteLength?(this.mBufferCache=this.getBufferCacheSlice(h),this.mOffset=0):this.mOffset=h,new E({header:i,offset:c,headerByteLength:u,content:f,context:this})}async tryParseNextHeader(){if(!await this.tryRequireBufferSize(this.mOffset+e.HEADER_SIZE))return null;let r=u.findNextUstarSectorOffset(this.mBufferCache,this.mOffset);for(;r<0&&await this.loadNextChunk();)r=u.findNextUstarSectorOffset(this.mBufferCache,this.mOffset),r<0&&this.mBufferCache.byteLength>=S&&this.clearBufferCache();if(r<0)return this.clearBufferCache(),null;let n=r,i=this.getBufferCacheSlice(n,n+e.HEADER_SIZE),s=m.deserialize(i),a=t.advanceSectorOffset(n,this.mBufferCache.byteLength);return s.isPaxHeader?this.parseNextPaxHeader(s,n,a):s.isGnuLongHeader?this.parseNextGnuLongHeader(s,n,a):{header:new g({ustar:s}),headerOffset:n,contentOffset:a}}async parseNextPaxHeader(r,n,i){const s=i+t.roundUpSectorOffset(r.fileSize),a=s+e.HEADER_SIZE,o=r.isGlobalPaxHeader,c=r;if(!await this.tryRequireBufferSize(a))throw p.ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET;const h=d.deserialize(this.mBufferCache,i);if(i=s,!u.isUstarSector(this.mBufferCache,i))throw p.ERR_HEADER_MISSING_POST_PAX_SEGMENT;const f=i,l=this.getBufferCacheSlice(f,f+e.HEADER_SIZE);r=m.deserialize(l),i=t.advanceSectorOffsetUnclamped(i);const E=new g({ustar:r,pax:h,preamble:c});return o&&this.mGlobalPaxHeaders.push(E),{header:E,headerOffset:n,contentOffset:i}}async parseNextGnuLongHeader(r,n,i){const s=i+t.roundUpSectorOffset(r.fileSize),a=s+e.HEADER_SIZE,o=r;if(!await this.tryRequireBufferSize(a))throw p.ERR_MIN_BUFFER_LENGTH_NOT_MET;const c=this.getBufferCacheSlice(i,i+r.fileSize),h=t.decodeString(c),f=new I({longPath:r.isGnuLongPathHeader?h:void 0,longLinkPath:r.isGnuLongLinkPathHeader?h:void 0});if(i=s,!u.isUstarSector(this.mBufferCache,i))throw p.ERR_MISSING_HEADER_SEGMENT;const l=i,d=this.getBufferCacheSlice(l,l+e.HEADER_SIZE);return r=m.deserialize(d),i=t.advanceSectorOffsetUnclamped(i),{header:new g({ustar:r,gnu:f,preamble:o}),headerOffset:n,contentOffset:i}}}class L{entries;constructor(e=[]){this.entries=e}static serialize(t){let r=e.TERMINAL_PADDING_SIZE;const n=[];for(const e of t){const t=e.toUint8Array();n.push(t),r+=t.byteLength}const i=new Uint8Array(r);let s=0;for(const e of n)i.set(e,s),s+=e.byteLength;return i}toUint8Array(){return L.serialize(this.entries)}addEntry(e){return this.entries.push(e),this}addEntryWith(e,t){return this.addEntry(new E({headerAttributes:e,content:t}))}addTextFile(e,r,n){return this.addBinaryFile(e,t.encodeString(r),n)}addBinaryFile(e,t,r={}){const n=Object.assign({fileName:e,fileSize:t.byteLength,typeFlag:a.NORMAL_FILE},r);return this.addEntryWith(n,t)}addDirectory(e,t={}){const r=Object.assign({fileName:e,typeFlag:a.DIRECTORY},t);return this.addEntryWith(r)}removeEntriesWhere(e){return this.entries=this.entries.filter(t=>!e(t)),this}cleanAllHeaders(){for(const e of this.entries)e.header.clean();return this}}class M extends L{constructor(e){super(e)}static async extract(e){const t=T.withInput(e),r=await t.readAllEntries();return new M(r)}static read(e,t){return T.withInput(e,t)}}module.exports=c}();