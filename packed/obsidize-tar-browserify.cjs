!function(){"use strict";var e,t,r,i,n,s,a,u,o={d:function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},c={};o.r(c),o.d(c,{Archive:function(){return T},ArchiveEntry:function(){return E},ArchiveReadError:function(){return p},ArchiveReader:function(){return S},ArchiveWriter:function(){return _},AsyncUint8ArrayIterator:function(){return y},Constants:function(){return e},InMemoryAsyncUint8Array:function(){return g},PaxHeader:function(){return h},PaxHeaderKey:function(){return n},PaxHeaderSegment:function(){return l},TarHeader:function(){return m},TarHeaderUtility:function(){return u},TarUtility:function(){return t},UstarHeader:function(){return d},UstarHeaderField:function(){return f},UstarHeaderFieldTransformType:function(){return i},UstarHeaderFieldType:function(){return r},UstarHeaderLinkIndicatorType:function(){return a}}),function(e){e.SECTOR_SIZE=512,e.OCTAL_RADIX=8,e.USTAR_TAG="ustar",e.USTAR_INDICATOR_VALUE=`${e.USTAR_TAG}\0`,e.USTAR_VERSION_VALUE="00",e.HEADER_SIZE=e.SECTOR_SIZE,e.FILE_MODE_DEFAULT=511,e.TERMINAL_PADDING_SIZE=2*e.SECTOR_SIZE,e.PAX_HEADER_PREFIX="PaxHeader"}(e||(e={})),function(t){function r(e){return"number"==typeof e&&!Number.isNaN(e)}function i(e){return"string"==typeof e}function n(e){return void 0===e}function s(e){return i(e)&&e.length>0}function a(e){return!!(e&&e instanceof Uint8Array)}function u(t){return(1+Math.floor(t/e.SECTOR_SIZE))*e.SECTOR_SIZE}function o(t){return Math.ceil(t/e.SECTOR_SIZE)*e.SECTOR_SIZE}function c(e){return Math.floor(h(e)/1e3)}function f(e){return 1e3*Math.floor(h(e))}function l(e){return f(c(e))}function h(e,t=10,i=0){if(r(e))return Math.floor(e);const n=parseInt(e,t);return r(n)?n:i}t.isNumber=r,t.isString=i,t.isUndefined=n,t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDefined=function(e){return!n(e)},t.isPopulatedString=s,t.isUint8Array=a,t.sizeofUint8Array=function(e){return a(e)?e.byteLength:0},t.encodeString=function(e){return s(e)?(new TextEncoder).encode(e):new Uint8Array(0)},t.decodeString=function(e){return a(e)?(new TextDecoder).decode(e):""},t.generateChecksum=function(e){return a(e)?e.reduce((e,t)=>e+t,0):0},t.clamp=function(e,t,r){return Math.max(t,Math.min(e,r))},t.advanceSectorOffset=function(e,t){return Math.min(t,u(e))},t.advanceSectorOffsetUnclamped=u,t.roundUpSectorOffset=o,t.getSectorOffsetDelta=function(e){return o(e)-e},t.parseIntOctal=function(t){return h(t,e.OCTAL_RADIX)},t.dateTimeToUstar=c,t.ustarTimeToDate=f,t.sanitizeDateTimeAsUstar=l,t.getUstarTimestamp=function(){return l(Date.now())},t.paxTimeToDate=function(e){return Math.floor(1e3*e)},t.paxTimeToUstar=function(e){return Math.floor(e)},t.getDebugHexString=function(e){return a(e)?Array.from(e).map(e=>e.toString(16).padStart(2,"0").toUpperCase()).join(" "):""},t.getDebugBufferJson=function(e){return{byteLength:e?.byteLength??0,content:t.getDebugHexString(e)}},t.removeTrailingZeros=function(e){const t=/^([^\0]*)[\0]*$/.exec(e);return t?t[1]:e},t.parseIntSafe=h,t.parseFloatSafe=function(e,t=0){if(r(e))return e;const i=parseFloat(e);return r(i)?i:t},t.cloneUint8Array=function(e,t,r){if(!a(e))return new Uint8Array(0);const i=e.slice(t,r),n=Array.from(i);return Uint8Array.from(n)},t.concatUint8Arrays=function(e,t){if(!a(t))return e;if(!a(e))return t;const r=e.byteLength,i=t.byteLength,n=new Uint8Array(r+i);return r>0&&n.set(e,0),i>0&&n.set(t,r),n}}(t||(t={})),function(e){e.ASCII="ASCII",e.ASCII_PADDED_END="ASCII_PADDED_END",e.INTEGER_OCTAL="INTEGER_OCTAL",e.INTEGER_OCTAL_TIMESTAMP="INTEGER_OCTAL_TIMESTAMP"}(r||(r={})),function(i){function n(r,i,n){const s=function(r,i){return t.parseIntSafe(r).toString(e.OCTAL_RADIX).padStart(i,"0").substring(0,i)}(r,Math.max(0,i-1-n.length))+n;return t.encodeString(s)}function s(e,t,r){return e.slice(r,r+t)}function a(r,i,n){const a=s(r,i,n);return t.parseIntSafe(t.decodeString(a).trim(),e.OCTAL_RADIX)}i.ASCII=Object.freeze({serialize:function(e,r){return t.encodeString(String(e).substring(0,r))},deserialize:function(e,r,i){const n=s(e,r,i);return t.decodeString(n)}}),i.ASCII_PADDED_END=Object.freeze({serialize:function(e,r){return(e=String(e)).length>r?t.encodeString(e.substring(0,r-1)+"\0"):t.encodeString(e.padEnd(r,"\0"))},deserialize:function(e,r,i){const n=s(e,r,i);return t.removeTrailingZeros(t.decodeString(n))}}),i.INTEGER_OCTAL=Object.freeze({serialize:function(e,t){return n(e,t," ")},deserialize:a}),i.INTEGER_OCTAL_TIMESTAMP=Object.freeze({serialize:function(e,r){return n(t.dateTimeToUstar(e),r,"")},deserialize:function(e,r,i){return t.ustarTimeToDate(a(e,r,i))}}),i.from=function(e){switch(e){case r.ASCII:return i.ASCII;case r.ASCII_PADDED_END:return i.ASCII_PADDED_END;case r.INTEGER_OCTAL:return i.INTEGER_OCTAL;case r.INTEGER_OCTAL_TIMESTAMP:return i.INTEGER_OCTAL_TIMESTAMP;default:return}}}(i||(i={}));class f{name;offset;size;type;constantValue;transform;constructor(e){this.name=e.name,this.offset=e.offset,this.size=e.size,this.type=e.type,this.constantValue=e.constantValue||void 0,this.transform=i.from(this.type)}static frozen(e){return Object.freeze(new f(e))}static fileName=f.frozen({name:"fileName",offset:0,size:100,type:r.ASCII_PADDED_END});static fileMode=f.frozen({name:"fileMode",offset:100,size:8,type:r.INTEGER_OCTAL});static ownerUserId=f.frozen({name:"ownerUserId",offset:108,size:8,type:r.INTEGER_OCTAL});static groupUserId=f.frozen({name:"groupUserId",offset:116,size:8,type:r.INTEGER_OCTAL});static fileSize=f.frozen({name:"fileSize",offset:124,size:12,type:r.INTEGER_OCTAL});static lastModified=f.frozen({name:"lastModified",offset:136,size:12,type:r.INTEGER_OCTAL_TIMESTAMP});static headerChecksum=f.frozen({name:"headerChecksum",offset:148,size:8,type:r.INTEGER_OCTAL});static typeFlag=f.frozen({name:"typeFlag",offset:156,size:1,type:r.ASCII});static linkedFileName=f.frozen({name:"linkedFileName",offset:157,size:100,type:r.ASCII_PADDED_END});static ustarIndicator=f.frozen({name:"ustarIndicator",offset:257,size:6,type:r.ASCII,constantValue:e.USTAR_INDICATOR_VALUE});static ustarVersion=f.frozen({name:"ustarVersion",offset:263,size:2,type:r.ASCII,constantValue:e.USTAR_VERSION_VALUE});static ownerUserName=f.frozen({name:"ownerUserName",offset:265,size:32,type:r.ASCII_PADDED_END});static ownerGroupName=f.frozen({name:"ownerGroupName",offset:297,size:32,type:r.ASCII_PADDED_END});static deviceMajorNumber=f.frozen({name:"deviceMajorNumber",offset:329,size:8,type:r.ASCII_PADDED_END});static deviceMinorNumber=f.frozen({name:"deviceMinorNumber",offset:337,size:8,type:r.ASCII_PADDED_END});static fileNamePrefix=f.frozen({name:"fileNamePrefix",offset:345,size:155,type:r.ASCII_PADDED_END});static all(){return[f.fileName,f.fileMode,f.ownerUserId,f.groupUserId,f.fileSize,f.lastModified,f.headerChecksum,f.typeFlag,f.linkedFileName,f.ustarIndicator,f.ustarVersion,f.ownerUserName,f.ownerGroupName,f.deviceMajorNumber,f.deviceMinorNumber,f.fileNamePrefix]}static checksumSet(){return f.all().filter(e=>e!==f.headerChecksum)}sliceString(e,r){return t.decodeString(this.slice(e,r))}slice(e,r=0){if(!t.isUint8Array(e))return new Uint8Array(0);const i=r+this.offset,n=i+this.size;return e.slice(i,n)}deserialize(e,r=0){if(t.isUint8Array(e))return this.transform.deserialize(e,this.size,r)}serialize(e){const t=new Uint8Array(this.size),r=this.transform.serialize(e,this.size);return t.set(r,0),t}readFrom(e,t){return this.deserialize(e,t+this.offset)}writeTo(e,r,i){r=Math.max(r,0);const n=this.serialize(i),s=n.byteLength,a=r+this.offset;return!!(s>0&&t.isUint8Array(e)&&e.byteLength>=a+s)&&(e.set(n,a),!0)}calculateChecksum(e,r=0){let i=0;if(!t.isUint8Array(e))return i;const n=r+this.offset,s=n+this.size;for(let t=n;t<s;t++)i+=e[t];return i}}!function(e){e.ACCESS_TIME="atime",e.CHARSET="charset",e.COMMENT="comment",e.GROUP_ID="gid",e.GROUP_NAME="gname",e.HDR_CHARSET="hdrcharset",e.LINK_PATH="linkpath",e.MODIFICATION_TIME="mtime",e.PATH="path",e.SIZE="size",e.USER_ID="uid",e.USER_NAME="uname"}(n||(n={}));class l{mKey;mValue;mBytes;constructor(e="",t="",r=null){this.mKey=e,this.mValue=t,this.mBytes=r}static serialize(e,r){if(!e||!r)return new Uint8Array(0);const i=` ${e}=${r}\n`,n=i.length.toString().length;let s=i.length+n;s<s.toString().length+i.length&&(s+=1);const a=s.toString()+i;return t.encodeString(a)}static deserialize(e,r=0){if(!t.isUint8Array(e))return null;const i=l.findNextLengthEndIndex(e,r);if(i<0)return null;const n=t.decodeString(e.slice(r,i)),s=parseInt(n,10);if(isNaN(s))return null;const a=i+1,u=r+s,o=t.decodeString(e.slice(a,u)),c=o.indexOf("="),f=o.substring(0,c),h=o.substring(c+1).replace(/\n$/,""),d=t.cloneUint8Array(e,r,r+s);return new l(f,h,d)}static findNextLengthEndIndex(e,t){let r=t+1;for(;r<e.byteLength;){if(32===e[r])return r;r+=1}return-1}get key(){return this.mKey}get value(){return this.mValue}get bytes(){return this.toUint8Array()}get intValue(){const e=parseInt(this.value);return isNaN(e)?void 0:e}get floatValue(){const e=parseFloat(this.value);return isNaN(e)?void 0:e}toUint8Array(){return t.isUint8Array(this.mBytes)||(this.mBytes=l.serialize(this.key,this.value)),this.mBytes}toJSON(){const{key:e,value:r,bytes:i}=this;return{key:e,value:r,content:t.getDebugHexString(i)}}}!function(e){const t=[n.COMMENT,n.GROUP_ID,n.GROUP_NAME,n.HDR_CHARSET,n.LINK_PATH,n.MODIFICATION_TIME,n.PATH,n.SIZE,n.USER_ID,n.USER_NAME];e.isKnownHeaderKey=function(e){return t.includes(e)}}(s||(s={}));class h{valueMap;constructor(e=[]){this.valueMap={};for(const t of e)this.valueMap[t.key]=t}static deserialize(e,t=0){const r=h.deserializeSegments(e,t);return new h(r)}static fromAttributes(e){const t=h.parseSegmentsFromAttributes(e);return new h(t)}static serializeAttributes(e){const t=h.parseSegmentsFromAttributes(e);return h.serializeSegments(t)}static parseSegmentsFromAttributes(e){if(!t.isObject(e))return[];const r=[];for(const[i,n]of Object.entries(e)){const e=t.isString(n)?n:String(n);r.push(new l(i,e))}return r}static serializeSegments(e){if(!Array.isArray(e)||e.length<=0)return new Uint8Array(0);let t=0,r=[];for(const i of e){const e=i.toUint8Array();r.push(e),t+=e.byteLength}const i=new Uint8Array(t);let n=0;for(const e of r)i.set(e,n),n+=e.byteLength;return i}static wrapFileName(r){if(!t.isString(r)||r.includes(e.PAX_HEADER_PREFIX))return r;let i=r.lastIndexOf("/");return i>=0?h.insertPaxAt(r,"/",i):(i=r.lastIndexOf("\\"),i>=0?h.insertPaxAt(r,"\\",i):h.makeTopLevelPrefix(r,"/",0))}static insertPaxAt(t,r,i){const n=f.fileName.size;return t.length<n?t.substring(0,i)+r+e.PAX_HEADER_PREFIX+t.substring(i):h.makeTopLevelPrefix(t,"/",i+1)}static makeTopLevelPrefix(t,r,i){const n=f.fileName.size;let s=e.PAX_HEADER_PREFIX+r+t.substring(i);return s.length>n&&(s=s.substring(0,n-2)+"\0\0"),s}static deserializeSegments(e,t){const r=[];let i=t,n=l.deserialize(e,i);for(;null!==n;)r.push(n),i+=n.bytes.byteLength,n=l.deserialize(e,i);return r}get accessTime(){return this.getFloat(n.ACCESS_TIME)}get charset(){return this.get(n.CHARSET)}get comment(){return this.get(n.COMMENT)}get groupId(){return this.getInt(n.GROUP_ID)}get groupName(){return this.get(n.GROUP_NAME)}get hdrCharset(){return this.get(n.HDR_CHARSET)}get linkPath(){return this.get(n.LINK_PATH)}get modificationTime(){return this.getFloat(n.MODIFICATION_TIME)}get path(){return this.get(n.PATH)}get size(){return this.getInt(n.SIZE)}get userId(){return this.getInt(n.USER_ID)}get userName(){return this.get(n.USER_NAME)}get lastModified(){const e=this.modificationTime;return e?t.paxTimeToDate(e):void 0}keys(){return Object.keys(this.valueMap)}values(){return Object.values(this.valueMap)}clean(){for(const e of this.keys())s.isKnownHeaderKey(e)||delete this.valueMap[e];return this}has(e){return t.isDefined(this.valueMap[e])}get(e){return this.valueMap[e]?.value}getInt(e){return this.valueMap[e]?.intValue}getFloat(e){return this.valueMap[e]?.floatValue}toUint8Array(){return h.serializeSegments(this.values())}toUint8ArrayPadded(){const e=this.toUint8Array();let r=t.getSectorOffsetDelta(e.byteLength);return r>0?t.concatUint8Arrays(e,new Uint8Array(r)):e}toJSON(){const{valueMap:e}=this,r=this.toUint8Array();return{attributes:e,buffer:t.getDebugBufferJson(r)}}}!function(e){e.UNKNOWN="UNKNOWN",e.NORMAL_FILE="0",e.NORMAL_FILE_ALT1="\0",e.NORMAL_FILE_ALT2="",e.HARD_LINK="1",e.SYMBOLIC_LINK="2",e.CHARACTER_SPECIAL="3",e.BLOCK_SPECIAL="4",e.DIRECTORY="5",e.FIFO="6",e.CONTIGUOUS_FILE="7",e.GLOBAL_EXTENDED_HEADER="g",e.LOCAL_EXTENDED_HEADER="x",e.LONG_LINK_HEADER="L"}(a||(a={})),function(r){function i(t,r){return f.ustarIndicator.sliceString(t,r).startsWith(e.USTAR_TAG)}r.CHECKSUM_SEED_STRING="".padStart(f.headerChecksum.size," "),r.CHECKSUM_SEED=t.generateChecksum(t.encodeString(r.CHECKSUM_SEED_STRING)),r.ALL_FIELDS=f.all(),r.CHECKSUM_FIELDS=f.checksumSet(),r.isUstarSector=i,r.isTarHeaderLinkIndicatorTypeDirectory=function(e){return e===a.DIRECTORY},r.isTarHeaderLinkIndicatorTypeFile=function(e){switch(e){case a.NORMAL_FILE:case a.NORMAL_FILE_ALT1:case a.NORMAL_FILE_ALT2:case a.CONTIGUOUS_FILE:return!0;default:return!1}},r.isTarHeaderLinkIndicatorTypePax=function(e){switch(e){case a.LOCAL_EXTENDED_HEADER:case a.GLOBAL_EXTENDED_HEADER:return!0;default:return!1}},r.findNextUstarSectorOffset=function(e,r=0){if(!t.isUint8Array(e))return-1;const n=e.byteLength;let s=Math.max(0,r);for(;s<n&&!i(e,s);)s=t.advanceSectorOffset(s,n);return s<n?s:-1}}(u||(u={}));class d{mValueMap=d.defaultValues();constructor(e={}){this.update(e)}static isUstarHeader(e){return!!(e&&e instanceof d)}static fromAttributes(e){return d.isUstarHeader(e)?e:new d(e)}static serializeAttributes(e){return d.fromAttributes(e).toUint8Array()}static deserialize(e,t=0){if(!u.isUstarSector(e,t))return null;const r={};for(const i of u.ALL_FIELDS)r[i.name]=i.readFrom(e,t);return new d(r)}static defaultValues(){return{fileName:"",fileMode:e.FILE_MODE_DEFAULT,groupUserId:0,ownerUserId:0,fileSize:0,lastModified:t.getUstarTimestamp(),headerChecksum:0,linkedFileName:"",typeFlag:a.NORMAL_FILE,ustarIndicator:e.USTAR_INDICATOR_VALUE,ustarVersion:e.USTAR_VERSION_VALUE,ownerUserName:"",ownerGroupName:"",deviceMajorNumber:"00",deviceMinorNumber:"00",fileNamePrefix:""}}get fileName(){return this.mValueMap.fileName}set fileName(e){this.mValueMap.fileName=e}get fileMode(){return this.mValueMap.fileMode}set fileMode(e){this.mValueMap.fileMode=e}get ownerUserId(){return this.mValueMap.ownerUserId}set ownerUserId(e){this.mValueMap.ownerUserId=e}get groupUserId(){return this.mValueMap.groupUserId}set groupUserId(e){this.mValueMap.groupUserId=e}get fileSize(){return this.mValueMap.fileSize}set fileSize(e){this.mValueMap.fileSize=e}get lastModified(){return this.mValueMap.lastModified}set lastModified(e){this.mValueMap.lastModified=t.sanitizeDateTimeAsUstar(e)}get headerChecksum(){return this.mValueMap.headerChecksum}set headerChecksum(e){this.mValueMap.headerChecksum=e}get linkedFileName(){return this.mValueMap.linkedFileName}set linkedFileName(e){this.mValueMap.linkedFileName=e}get typeFlag(){return this.mValueMap.typeFlag}set typeFlag(e){this.mValueMap.typeFlag=e}get ustarIndicator(){return this.mValueMap.ustarIndicator}get ustarVersion(){return this.mValueMap.ustarVersion}set ustarVersion(e){this.mValueMap.ustarVersion=e}get ownerUserName(){return this.mValueMap.ownerUserName}set ownerUserName(e){this.mValueMap.ownerUserName=e}get ownerGroupName(){return this.mValueMap.ownerGroupName}set ownerGroupName(e){this.mValueMap.ownerGroupName=e}get deviceMajorNumber(){return this.mValueMap.deviceMajorNumber}set deviceMajorNumber(e){this.mValueMap.deviceMajorNumber=e}get deviceMinorNumber(){return this.mValueMap.deviceMinorNumber}set deviceMinorNumber(e){this.mValueMap.deviceMinorNumber=e}get fileNamePrefix(){return this.mValueMap.fileNamePrefix}set fileNamePrefix(e){this.mValueMap.fileNamePrefix=e}get isPaxHeader(){return this.isLocalPaxHeader||this.isGlobalPaxHeader}get isGlobalPaxHeader(){return this.typeFlag===a.GLOBAL_EXTENDED_HEADER}get isLocalPaxHeader(){return this.typeFlag===a.LOCAL_EXTENDED_HEADER}get isFileHeader(){return u.isTarHeaderLinkIndicatorTypeFile(this.typeFlag)}get isDirectoryHeader(){return u.isTarHeaderLinkIndicatorTypeDirectory(this.typeFlag)}update(e){return Object.assign(this.mValueMap,e),this}toAttributes(){return Object.assign({},this.mValueMap)}toUint8Array(){const t=new Uint8Array(e.HEADER_SIZE);let r=u.CHECKSUM_SEED;for(const e of u.CHECKSUM_FIELDS)e.writeTo(t,0,this.mValueMap[e.name]),r+=e.calculateChecksum(t);return this.headerChecksum=r,f.headerChecksum.writeTo(t,0,r),t}toJSON(){const e=this.toAttributes(),r=this.toUint8Array();return{attributes:e,buffer:t.getDebugBufferJson(r)}}}class m{ustar;pax;mPreamble;mIsGlobal;constructor(e){const{ustar:t,pax:r,preamble:i,isPaxGlobal:n}=e;this.ustar=t,this.pax=r,this.mPreamble=i,this.mIsGlobal=!!n,this.trySyncPaxHeader()}static isTarHeader(e){return!!(e&&e instanceof m)}static fromAttributes(e){if(m.isTarHeader(e))return e;const t=new d(e),r=m.collectPaxRequiredAttributes(e);let i;if(r){const[e,n]=m.splitBaseFileName(r.path);t.fileName=n,t.fileNamePrefix=e,i=h.fromAttributes(r)}return new m({ustar:t,pax:i})}static serializeAttributes(e){return m.isTarHeader(e)?e.toUint8Array():m.fromAttributes(e).toUint8Array()}static collectPaxRequiredAttributes(e){if(t.isObject(e)){let t={};if(e.fileName&&e.fileName.length>f.fileName.size&&(t.path=e.fileName),Object.keys(t).length>0)return t}return null}static splitBaseFileName(e){let t=e.lastIndexOf("/");return t>=0?[e.substring(0,t),e.substring(t+1)]:(t=e.lastIndexOf("\\"),t>=0?[e.substring(0,t),e.substring(t+1)]:["",e])}get preamble(){return this.mPreamble}get fileName(){return this.pax?.path||this.ustar.fileName}get fileMode(){return this.ustar.fileMode}get ownerUserId(){return this.pax?.userId||this.ustar.ownerUserId}get groupUserId(){return this.pax?.groupId||this.ustar.groupUserId}get fileSize(){return this.pax?.size||this.ustar.fileSize}get lastModified(){return this.pax?.lastModified||this.ustar.lastModified}get headerChecksum(){return this.ustar.headerChecksum}get linkedFileName(){return this.pax?.linkPath||this.ustar.linkedFileName}get typeFlag(){return this.ustar.typeFlag}get ustarIndicator(){return this.ustar.ustarIndicator}get ustarVersion(){return this.ustar.ustarVersion}get ownerUserName(){return this.pax?.userName||this.ustar.ownerUserName}get ownerGroupName(){return this.pax?.groupName||this.ustar.ownerGroupName}get deviceMajorNumber(){return this.ustar.deviceMajorNumber}get deviceMinorNumber(){return this.ustar.deviceMinorNumber}get fileNamePrefix(){return this.ustar.fileNamePrefix}get isPaxHeader(){return this.isLocalPaxHeader||this.isGlobalPaxHeader}get isGlobalPaxHeader(){return this.isGlobalPaxPreHeader||this.isGlobalPaxPostHeader}get isLocalPaxHeader(){return this.isLocalPaxPreHeader||this.isLocalPaxPostHeader}get isGlobalPaxPreHeader(){return this.ustar.isGlobalPaxHeader}get isLocalPaxPreHeader(){return this.ustar.isLocalPaxHeader}get isGlobalPaxPostHeader(){return this.preamble?.isGlobalPaxHeader??!1}get isLocalPaxPostHeader(){return this.preamble?.isLocalPaxHeader??!1}get isFileHeader(){return this.ustar.isFileHeader}get isDirectoryHeader(){return this.ustar.isDirectoryHeader}clean(){return this.pax?.clean(),this}normalize(){return this.trySyncPaxHeader(),this}toUint8Array(){if(this.normalize(),!(this.isPaxHeader&&this.pax&&this.preamble))return this.ustar.toUint8Array();const e=this.preamble.toUint8Array(),t=this.pax.toUint8ArrayPadded(),r=this.ustar.toUint8Array(),i=e.byteLength+t.byteLength+r.byteLength,n=new Uint8Array(i);let s=0;return n.set(e,s),s+=e.byteLength,n.set(t,s),s+=t.byteLength,n.set(r,s),n}toJSON(){const{pax:e,preamble:t,ustar:r}=this;return{preamble:t,pax:e,ustar:r}}trySyncPaxHeader(){if(!this.pax)return;const e=this.fileName,t=this.pax.toUint8Array().byteLength,r=this.pax.lastModified,i={fileName:e,typeFlag:this.mIsGlobal?a.GLOBAL_EXTENDED_HEADER:a.LOCAL_EXTENDED_HEADER,lastModified:r,fileSize:t};this.mPreamble?this.mPreamble.update(i):this.mPreamble=new d(i)}}class E{mHeader;mHeaderByteLength;mContent;mOffset;mContext;constructor(e={}){let{header:r,headerAttributes:i,headerByteLength:n,content:s,offset:a,context:u}=e;r||(r=m.fromAttributes(i||{})),s||(s=null),a||(a=0),u||(u=null);const o=t.sizeofUint8Array(s);!r.pax&&r.fileSize!==o&&o>0&&(r.ustar.fileSize=o),n||(n=r.toUint8Array().byteLength),this.mHeader=r,this.mHeaderByteLength=n,this.mContent=s,this.mOffset=a,this.mContext=u}static isArchiveEntry(e){return!!(e&&e instanceof E)}get fileName(){return this.header.fileName}get fileSize(){return this.header.fileSize}get fileMode(){return this.header.fileMode}get ownerUserId(){return this.header.ownerUserId}get groupUserId(){return this.header.groupUserId}get lastModified(){return this.header.lastModified}get headerChecksum(){return this.header.headerChecksum}get linkedFileName(){return this.header.linkedFileName}get typeFlag(){return this.header.typeFlag}get ustarIndicator(){return this.header.ustarIndicator}get ustarVersion(){return this.header.ustarVersion}get ownerUserName(){return this.header.ownerUserName}get ownerGroupName(){return this.header.ownerGroupName}get deviceMajorNumber(){return this.header.deviceMajorNumber}get deviceMinorNumber(){return this.header.deviceMinorNumber}get fileNamePrefix(){return this.header.fileNamePrefix}get header(){return this.mHeader}get content(){return this.mContent}get sourceOffset(){return this.mOffset}get sourceHeaderByteLength(){return this.mHeaderByteLength}get sourceContext(){return this.mContext}isDirectory(){return this.header.isDirectoryHeader}isFile(){return this.header.isFileHeader}text(){return t.decodeString(this.content)}async readContentFrom(e,r=0,i=0){const n=this.fileSize,s=this.sourceOffset+this.sourceHeaderByteLength,a=s+n,u=s+t.clamp(r,0,n),o=Math.max(0,a-u),c=i>0?Math.min(i,o):o;return e.read(u,c)}toUint8Array(){const e=this.header.toUint8Array(),r=this.content?.byteLength??0,i=t.roundUpSectorOffset(e.byteLength+r),n=new Uint8Array(i);return n.set(e,0),r>0&&n.set(this.content,e.byteLength),n}toJSON(){const{header:e,fileName:r,fileSize:i,content:n}=this,s=this.isFile(),a=this.isDirectory();return{name:r,size:i,type:s?"file":a?"directory":"complex",header:e,contentType:n?"Uint8Array["+n.byteLength+"]":"null",content:t.getDebugHexString(n)}}}class g{input;constructor(e){this.input=e}get byteLength(){return this.input.byteLength}read(e,t){const r=this.input.byteLength,i=Math.min(e,r),n=Math.min(i+t,r);return Promise.resolve(this.input.slice(i,n))}}const A=e.SECTOR_SIZE,I=1e4*e.SECTOR_SIZE*4;class y{mInput;blockSize;mOffset=0;constructor(e,r={}){this.mInput=t.isUint8Array(e)?new g(e):e;let{blockSize:i}=function(e){return Object.assign({blockSize:I/2},e)}(r);i=t.clamp(i,A,I),i=t.roundUpSectorOffset(i),this.blockSize=i}[Symbol.asyncIterator](){return this}get input(){return this.mInput}get byteLength(){return this.mInput.byteLength}get currentOffset(){return this.mOffset}async tryNext(){const e=await this.next();return e?.value?.buffer??null}async next(){const e=this.input,t=this.currentOffset,r=this.byteLength;if(t>=r)return{done:!0,value:null};const i=Math.min(this.blockSize,r-t),n=await e.read(t,i);return this.mOffset+=i,{done:!1,value:{source:e,buffer:n,offset:t}}}}const N=1e5*e.SECTOR_SIZE;var p;!function(e){e.ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET="ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET="ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_HEADER_MISSING_POST_PAX_SEGMENT="ERR_HEADER_MISSING_POST_PAX_SEGMENT"}(p||(p={}));class S{bufferIterator;mGlobalPaxHeaders=[];mBufferCache=null;mOffset=0;mHasSyncInput;constructor(e){this.bufferIterator=e,this.mHasSyncInput=this.bufferIterator.input instanceof g}static withInput(e,t){return new S(new y(e,t))}[Symbol.asyncIterator](){return this}get source(){return this.bufferIterator.input}get globalPaxHeaders(){return this.mGlobalPaxHeaders}async readAllEntries(){const e=[];for await(const t of this)e.push(t);return e}async next(){const e=await this.tryParseNextEntry();return null!==e?{done:!1,value:e}:{done:!0,value:null}}clearBufferCache(){this.mBufferCache=null,this.mOffset=0}getBufferCacheSlice(e,r){return t.cloneUint8Array(this.mBufferCache,e,r)}async tryRequireBufferSize(e){return null!==await this.requireBufferSize(e)}async requireBufferSize(e){for(;!this.mBufferCache||this.mBufferCache.byteLength<e;)if(!await this.loadNextChunk())return this.clearBufferCache(),null;return this.mBufferCache}async loadNextChunk(){const e=await this.bufferIterator.tryNext();return!!e&&(this.mBufferCache?this.mBufferCache=t.concatUint8Arrays(this.mBufferCache,e):(this.mBufferCache=e,this.mOffset=0),!0)}async tryParseNextEntry(){const r=await this.tryParseNextHeader();if(null===r)return this.clearBufferCache(),null;const{header:i,headerOffset:n,contentOffset:s}=r,a=s-n,u=s+i.fileSize,o=n,c=t.roundUpSectorOffset(u);let f=null;if(this.mHasSyncInput&&i.fileSize>0){if(!await this.tryRequireBufferSize(c))throw p.ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET;f=this.getBufferCacheSlice(s,u)}return c+e.SECTOR_SIZE<=this.mBufferCache.byteLength?(this.mBufferCache=this.getBufferCacheSlice(c),this.mOffset=0):this.mOffset=c,new E({header:i,offset:o,headerByteLength:a,content:f,context:this})}async tryParseNextHeader(){if(!await this.tryRequireBufferSize(this.mOffset+e.HEADER_SIZE))return null;let r=u.findNextUstarSectorOffset(this.mBufferCache,this.mOffset);for(;r<0&&await this.loadNextChunk();)r=u.findNextUstarSectorOffset(this.mBufferCache,this.mOffset),r<0&&this.mBufferCache.byteLength>=N&&this.clearBufferCache();if(r<0)return this.clearBufferCache(),null;let i=r,n=this.getBufferCacheSlice(i,i+e.HEADER_SIZE),s=d.deserialize(n),a=new m({ustar:s}),o=t.advanceSectorOffset(i,this.mBufferCache.byteLength);if(s.isPaxHeader){const r=o+t.roundUpSectorOffset(a.fileSize),c=r+e.HEADER_SIZE,f=a.isGlobalPaxHeader,l=s;if(!await this.tryRequireBufferSize(c))throw p.ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET;const E=h.deserialize(this.mBufferCache,o);if(o=r,!u.isUstarSector(this.mBufferCache,o))throw p.ERR_HEADER_MISSING_POST_PAX_SEGMENT;i=o,n=this.getBufferCacheSlice(i,i+e.HEADER_SIZE),s=d.deserialize(n),o=t.advanceSectorOffsetUnclamped(o),a=new m({ustar:s,pax:E,preamble:l}),f&&this.mGlobalPaxHeaders.push(a)}return{header:a,headerOffset:i,contentOffset:o}}}class _{entries;constructor(e=[]){this.entries=e}static serialize(t){let r=e.TERMINAL_PADDING_SIZE;const i=[];for(const e of t){const t=e.toUint8Array();i.push(t),r+=t.byteLength}const n=new Uint8Array(r);let s=0;for(const e of i)n.set(e,s),s+=e.byteLength;return n}toUint8Array(){return _.serialize(this.entries)}addEntry(e){return this.entries.push(e),this}addEntryWith(e,t){return this.addEntry(new E({headerAttributes:e,content:t}))}addTextFile(e,r,i){return this.addBinaryFile(e,t.encodeString(r),i)}addBinaryFile(e,t,r={}){const i=Object.assign({fileName:e,fileSize:t.byteLength,typeFlag:a.NORMAL_FILE},r);return this.addEntryWith(i,t)}addDirectory(e,t={}){const r=Object.assign({fileName:e,typeFlag:a.DIRECTORY},t);return this.addEntryWith(r)}removeEntriesWhere(e){return this.entries=this.entries.filter(t=>!e(t)),this}cleanAllHeaders(){for(const e of this.entries)e.header.clean();return this}}class T extends _{constructor(e){super(e)}static async extract(e){const t=S.withInput(e),r=await t.readAllEntries();return new T(r)}static read(e,t){return S.withInput(e,t)}}module.exports=c}();