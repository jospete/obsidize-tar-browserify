!function(){"use strict";var e={d:function(t,r){for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Archive:function(){return M},ArchiveEntry:function(){return _},ArchiveReadError:function(){return S},ArchiveReader:function(){return p},ArchiveWriter:function(){return T},AsyncUint8ArrayIterator:function(){return o},Constants:function(){return r},InMemoryAsyncUint8Array:function(){return s},PaxHeader:function(){return A},PaxHeaderKey:function(){return c},PaxHeaderSegment:function(){return g},TarHeader:function(){return I},TarHeaderUtility:function(){return m},TarUtility:function(){return i},UstarHeader:function(){return y},UstarHeaderField:function(){return E},UstarHeaderFieldTransformType:function(){return f},UstarHeaderFieldType:function(){return l},UstarHeaderLinkIndicatorType:function(){return d}});var r,i,n=require("tslib");class s{constructor(e){this.input=e}get byteLength(){return this.input.byteLength}read(e,t){const r=this.input.byteLength,i=Math.min(e,r),n=Math.min(i+t,r);return Promise.resolve(this.input.slice(i,n))}}!function(e){e.SECTOR_SIZE=512,e.OCTAL_RADIX=8,e.USTAR_TAG="ustar",e.USTAR_INDICATOR_VALUE=`${e.USTAR_TAG}\0`,e.USTAR_VERSION_VALUE="00",e.HEADER_SIZE=e.SECTOR_SIZE,e.FILE_MODE_DEFAULT=511,e.TERMINAL_PADDING_SIZE=2*e.SECTOR_SIZE,e.PAX_HEADER_PREFIX="PaxHeader"}(r||(r={})),function(e){function t(e){return"number"==typeof e&&!Number.isNaN(e)}function i(e){return"string"==typeof e}function n(e){return void 0===e}function s(e){return i(e)&&e.length>0}function a(e){return!!(e&&e instanceof Uint8Array)}function u(e){return(1+Math.floor(e/r.SECTOR_SIZE))*r.SECTOR_SIZE}function o(e){return Math.ceil(e/r.SECTOR_SIZE)*r.SECTOR_SIZE}function l(e){return Math.floor(h(e)/1e3)}function f(e){return 1e3*Math.floor(h(e))}function c(e){return f(l(e))}function h(e,r=10,i=0){if(t(e))return Math.floor(e);const n=parseInt(e,r);return t(n)?n:i}e.isNumber=t,e.isString=i,e.isUndefined=n,e.isObject=function(e){return"object"==typeof e&&null!==e},e.isDefined=function(e){return!n(e)},e.isPopulatedString=s,e.isUint8Array=a,e.sizeofUint8Array=function(e){return a(e)?e.byteLength:0},e.encodeString=function(e){return s(e)?(new TextEncoder).encode(e):new Uint8Array(0)},e.decodeString=function(e){return a(e)?(new TextDecoder).decode(e):""},e.generateChecksum=function(e){return a(e)?e.reduce((e,t)=>e+t,0):0},e.clamp=function(e,t,r){return Math.max(t,Math.min(e,r))},e.advanceSectorOffset=function(e,t){return Math.min(t,u(e))},e.advanceSectorOffsetUnclamped=u,e.roundUpSectorOffset=o,e.getSectorOffsetDelta=function(e){return o(e)-e},e.parseIntOctal=function(e){return h(e,r.OCTAL_RADIX)},e.dateTimeToUstar=l,e.ustarTimeToDate=f,e.sanitizeDateTimeAsUstar=c,e.getUstarTimestamp=function(){return c(Date.now())},e.paxTimeToDate=function(e){return Math.floor(1e3*e)},e.paxTimeToUstar=function(e){return Math.floor(e)},e.getDebugHexString=function(e){return a(e)?Array.from(e).map(e=>e.toString(16).padStart(2,"0").toUpperCase()).join(" "):""},e.getDebugBufferJson=function(t){var r;return{byteLength:null!==(r=null==t?void 0:t.byteLength)&&void 0!==r?r:0,content:e.getDebugHexString(t)}},e.removeTrailingZeros=function(e){const t=/^([^\0]*)[\0]*$/.exec(e);return t?t[1]:e},e.parseIntSafe=h,e.parseFloatSafe=function(e,r=0){if(t(e))return e;const i=parseFloat(e);return t(i)?i:r},e.cloneUint8Array=function(e,t,r){if(!a(e))return new Uint8Array(0);const i=e.slice(t,r),n=Array.from(i);return Uint8Array.from(n)},e.concatUint8Arrays=function(e,t){if(!a(t))return e;if(!a(e))return t;const r=e.byteLength,i=t.byteLength,n=new Uint8Array(r+i);return r>0&&n.set(e,0),i>0&&n.set(t,r),n}}(i||(i={}));const a=r.SECTOR_SIZE,u=1e4*r.SECTOR_SIZE;class o{constructor(e,t={}){this.mOffset=0,this.mInput=i.isUint8Array(e)?new s(e):e;let{blockSize:n}=function(e){return Object.assign({blockSize:16*r.SECTOR_SIZE},e)}(t);n=i.clamp(n,a,u),n=i.roundUpSectorOffset(n),this.blockSize=n}[Symbol.asyncIterator](){return this}get input(){return this.mInput}get byteLength(){return this.mInput.byteLength}get currentOffset(){return this.mOffset}tryNext(){var e,t;return(0,n.__awaiter)(this,void 0,void 0,function*(){const r=yield this.next();return null!==(t=null===(e=null==r?void 0:r.value)||void 0===e?void 0:e.buffer)&&void 0!==t?t:null})}next(){return(0,n.__awaiter)(this,void 0,void 0,function*(){const e=this.input,t=this.mOffset,r=this.byteLength;if(t>=r)return{done:!0,value:null};const i=Math.min(this.blockSize,r-t),n=yield e.read(t,i);return this.mOffset+=i,{done:!1,value:{source:e,buffer:n,offset:t}}})}}var l,f,c,h,d,m;!function(e){e.ASCII="ASCII",e.ASCII_PADDED_END="ASCII_PADDED_END",e.INTEGER_OCTAL="INTEGER_OCTAL",e.INTEGER_OCTAL_TIMESTAMP="INTEGER_OCTAL_TIMESTAMP"}(l||(l={})),function(e){function t(e,t,n){const s=function(e,t){return i.parseIntSafe(e).toString(r.OCTAL_RADIX).padStart(t,"0").substring(0,t)}(e,Math.max(0,t-1-n.length))+n;return i.encodeString(s)}function n(e,t,r){return e.slice(r,r+t)}function s(e,t,s){const a=n(e,t,s);return i.parseIntSafe(i.decodeString(a).trim(),r.OCTAL_RADIX)}e.ASCII=Object.freeze({serialize:function(e,t){return i.encodeString(String(e).substring(0,t))},deserialize:function(e,t,r){const s=n(e,t,r);return i.decodeString(s)}}),e.ASCII_PADDED_END=Object.freeze({serialize:function(e,t){return(e=String(e)).length>t?i.encodeString(e.substring(0,t-1)+"\0"):i.encodeString(e.padEnd(t,"\0"))},deserialize:function(e,t,r){const s=n(e,t,r);return i.removeTrailingZeros(i.decodeString(s))}}),e.INTEGER_OCTAL=Object.freeze({serialize:function(e,r){return t(e,r," ")},deserialize:s}),e.INTEGER_OCTAL_TIMESTAMP=Object.freeze({serialize:function(e,r){return t(i.dateTimeToUstar(e),r,"")},deserialize:function(e,t,r){return i.ustarTimeToDate(s(e,t,r))}}),e.from=function(t){switch(t){case l.ASCII:return e.ASCII;case l.ASCII_PADDED_END:return e.ASCII_PADDED_END;case l.INTEGER_OCTAL:return e.INTEGER_OCTAL;case l.INTEGER_OCTAL_TIMESTAMP:return e.INTEGER_OCTAL_TIMESTAMP;default:return}}}(f||(f={}));class E{constructor(e){this.name=e.name,this.offset=e.offset,this.size=e.size,this.type=e.type,this.constantValue=e.constantValue||void 0,this.transform=f.from(this.type)}static frozen(e){return Object.freeze(new E(e))}static all(){return[E.fileName,E.fileMode,E.ownerUserId,E.groupUserId,E.fileSize,E.lastModified,E.headerChecksum,E.typeFlag,E.linkedFileName,E.ustarIndicator,E.ustarVersion,E.ownerUserName,E.ownerGroupName,E.deviceMajorNumber,E.deviceMinorNumber,E.fileNamePrefix]}static checksumSet(){return E.all().filter(e=>e!==E.headerChecksum)}sliceString(e,t){return i.decodeString(this.slice(e,t))}slice(e,t=0){if(!i.isUint8Array(e))return new Uint8Array(0);const r=t+this.offset,n=r+this.size;return e.slice(r,n)}deserialize(e,t=0){if(i.isUint8Array(e))return this.transform.deserialize(e,this.size,t)}serialize(e){const t=new Uint8Array(this.size),r=this.transform.serialize(e,this.size);return t.set(r,0),t}readFrom(e,t){return this.deserialize(e,t+this.offset)}writeTo(e,t,r){t=Math.max(t,0);const n=this.serialize(r),s=n.byteLength,a=t+this.offset;return!!(s>0&&i.isUint8Array(e)&&e.byteLength>=a+s)&&(e.set(n,a),!0)}calculateChecksum(e,t=0){let r=0;if(!i.isUint8Array(e))return r;const n=t+this.offset,s=n+this.size;for(let t=n;t<s;t++)r+=e[t];return r}}E.fileName=E.frozen({name:"fileName",offset:0,size:100,type:l.ASCII_PADDED_END}),E.fileMode=E.frozen({name:"fileMode",offset:100,size:8,type:l.INTEGER_OCTAL}),E.ownerUserId=E.frozen({name:"ownerUserId",offset:108,size:8,type:l.INTEGER_OCTAL}),E.groupUserId=E.frozen({name:"groupUserId",offset:116,size:8,type:l.INTEGER_OCTAL}),E.fileSize=E.frozen({name:"fileSize",offset:124,size:12,type:l.INTEGER_OCTAL}),E.lastModified=E.frozen({name:"lastModified",offset:136,size:12,type:l.INTEGER_OCTAL_TIMESTAMP}),E.headerChecksum=E.frozen({name:"headerChecksum",offset:148,size:8,type:l.INTEGER_OCTAL}),E.typeFlag=E.frozen({name:"typeFlag",offset:156,size:1,type:l.ASCII}),E.linkedFileName=E.frozen({name:"linkedFileName",offset:157,size:100,type:l.ASCII_PADDED_END}),E.ustarIndicator=E.frozen({name:"ustarIndicator",offset:257,size:6,type:l.ASCII,constantValue:r.USTAR_INDICATOR_VALUE}),E.ustarVersion=E.frozen({name:"ustarVersion",offset:263,size:2,type:l.ASCII,constantValue:r.USTAR_VERSION_VALUE}),E.ownerUserName=E.frozen({name:"ownerUserName",offset:265,size:32,type:l.ASCII_PADDED_END}),E.ownerGroupName=E.frozen({name:"ownerGroupName",offset:297,size:32,type:l.ASCII_PADDED_END}),E.deviceMajorNumber=E.frozen({name:"deviceMajorNumber",offset:329,size:8,type:l.ASCII_PADDED_END}),E.deviceMinorNumber=E.frozen({name:"deviceMinorNumber",offset:337,size:8,type:l.ASCII_PADDED_END}),E.fileNamePrefix=E.frozen({name:"fileNamePrefix",offset:345,size:155,type:l.ASCII_PADDED_END}),function(e){e.ACCESS_TIME="atime",e.CHARSET="charset",e.COMMENT="comment",e.GROUP_ID="gid",e.GROUP_NAME="gname",e.HDR_CHARSET="hdrcharset",e.LINK_PATH="linkpath",e.MODIFICATION_TIME="mtime",e.PATH="path",e.SIZE="size",e.USER_ID="uid",e.USER_NAME="uname"}(c||(c={}));class g{constructor(e="",t="",r=null){this.mKey=e,this.mValue=t,this.mBytes=r}static serialize(e,t){if(!e||!t)return new Uint8Array(0);const r=` ${e}=${t}\n`,n=r.length.toString().length;let s=r.length+n;s<s.toString().length+r.length&&(s+=1);const a=s.toString()+r;return i.encodeString(a)}static deserialize(e,t=0){if(!i.isUint8Array(e))return null;const r=g.findNextLengthEndIndex(e,t);if(r<0)return null;const n=i.decodeString(e.slice(t,r)),s=parseInt(n,10);if(isNaN(s))return null;const a=r+1,u=t+s,o=i.decodeString(e.slice(a,u)),l=o.indexOf("="),f=o.substring(0,l),c=o.substring(l+1).replace(/\n$/,""),h=i.cloneUint8Array(e,t,t+s);return new g(f,c,h)}static findNextLengthEndIndex(e,t){let r=t+1;for(;r<e.byteLength;){if(32===e[r])return r;r+=1}return-1}get key(){return this.mKey}get value(){return this.mValue}get bytes(){return this.toUint8Array()}get intValue(){const e=parseInt(this.value);return isNaN(e)?void 0:e}get floatValue(){const e=parseFloat(this.value);return isNaN(e)?void 0:e}toUint8Array(){return i.isUint8Array(this.mBytes)||(this.mBytes=g.serialize(this.key,this.value)),this.mBytes}toJSON(){const{key:e,value:t,bytes:r}=this;return{key:e,value:t,content:i.getDebugHexString(r)}}}!function(e){const t=[c.COMMENT,c.GROUP_ID,c.GROUP_NAME,c.HDR_CHARSET,c.LINK_PATH,c.MODIFICATION_TIME,c.PATH,c.SIZE,c.USER_ID,c.USER_NAME];e.isKnownHeaderKey=function(e){return t.includes(e)}}(h||(h={}));class A{constructor(e=[]){this.valueMap={};for(const t of e)this.valueMap[t.key]=t}static deserialize(e,t=0){const r=A.deserializeSegments(e,t);return new A(r)}static fromAttributes(e){const t=A.parseSegmentsFromAttributes(e);return new A(t)}static serializeAttributes(e){const t=A.parseSegmentsFromAttributes(e);return A.serializeSegments(t)}static parseSegmentsFromAttributes(e){if(!i.isObject(e))return[];const t=[];for(const[r,n]of Object.entries(e)){const e=i.isString(n)?n:String(n);t.push(new g(r,e))}return t}static serializeSegments(e){if(!Array.isArray(e)||e.length<=0)return new Uint8Array(0);let t=0,r=[];for(const i of e){const e=i.toUint8Array();r.push(e),t+=e.byteLength}const i=new Uint8Array(t);let n=0;for(const e of r)i.set(e,n),n+=e.byteLength;return i}static wrapFileName(e){if(!i.isString(e)||e.includes(r.PAX_HEADER_PREFIX))return e;let t=e.lastIndexOf("/");return t>=0?A.insertPaxAt(e,"/",t):(t=e.lastIndexOf("\\"),t>=0?A.insertPaxAt(e,"\\",t):A.makeTopLevelPrefix(e,"/",0))}static insertPaxAt(e,t,i){const n=E.fileName.size;return e.length<n?e.substring(0,i)+t+r.PAX_HEADER_PREFIX+e.substring(i):A.makeTopLevelPrefix(e,"/",i+1)}static makeTopLevelPrefix(e,t,i){const n=E.fileName.size;let s=r.PAX_HEADER_PREFIX+t+e.substring(i);return s.length>n&&(s=s.substring(0,n-2)+"\0\0"),s}static deserializeSegments(e,t){const r=[];let i=t,n=g.deserialize(e,i);for(;null!==n;)r.push(n),i+=n.bytes.byteLength,n=g.deserialize(e,i);return r}get accessTime(){return this.getFloat(c.ACCESS_TIME)}get charset(){return this.get(c.CHARSET)}get comment(){return this.get(c.COMMENT)}get groupId(){return this.getInt(c.GROUP_ID)}get groupName(){return this.get(c.GROUP_NAME)}get hdrCharset(){return this.get(c.HDR_CHARSET)}get linkPath(){return this.get(c.LINK_PATH)}get modificationTime(){return this.getFloat(c.MODIFICATION_TIME)}get path(){return this.get(c.PATH)}get size(){return this.getInt(c.SIZE)}get userId(){return this.getInt(c.USER_ID)}get userName(){return this.get(c.USER_NAME)}get lastModified(){const e=this.modificationTime;return e?i.paxTimeToDate(e):void 0}keys(){return Object.keys(this.valueMap)}values(){return Object.values(this.valueMap)}clean(){for(const e of this.keys())h.isKnownHeaderKey(e)||delete this.valueMap[e];return this}has(e){return i.isDefined(this.valueMap[e])}get(e){var t;return null===(t=this.valueMap[e])||void 0===t?void 0:t.value}getInt(e){var t;return null===(t=this.valueMap[e])||void 0===t?void 0:t.intValue}getFloat(e){var t;return null===(t=this.valueMap[e])||void 0===t?void 0:t.floatValue}toUint8Array(){return A.serializeSegments(this.values())}toUint8ArrayPadded(){const e=this.toUint8Array();let t=i.getSectorOffsetDelta(e.byteLength);return t>0?i.concatUint8Arrays(e,new Uint8Array(t)):e}toJSON(){const{valueMap:e}=this,t=this.toUint8Array();return{attributes:e,buffer:i.getDebugBufferJson(t)}}}!function(e){e.UNKNOWN="UNKNOWN",e.NORMAL_FILE="0",e.NORMAL_FILE_ALT1="\0",e.NORMAL_FILE_ALT2="",e.HARD_LINK="1",e.SYMBOLIC_LINK="2",e.CHARACTER_SPECIAL="3",e.BLOCK_SPECIAL="4",e.DIRECTORY="5",e.FIFO="6",e.CONTIGUOUS_FILE="7",e.GLOBAL_EXTENDED_HEADER="g",e.LOCAL_EXTENDED_HEADER="x"}(d||(d={})),function(e){function t(e,t){return E.ustarIndicator.sliceString(e,t).startsWith(r.USTAR_TAG)}e.CHECKSUM_SEED_STRING="".padStart(E.headerChecksum.size," "),e.CHECKSUM_SEED=i.generateChecksum(i.encodeString(e.CHECKSUM_SEED_STRING)),e.ALL_FIELDS=E.all(),e.CHECKSUM_FIELDS=E.checksumSet(),e.isUstarSector=t,e.isTarHeaderLinkIndicatorTypeDirectory=function(e){return e===d.DIRECTORY},e.isTarHeaderLinkIndicatorTypeFile=function(e){switch(e){case d.NORMAL_FILE:case d.NORMAL_FILE_ALT1:case d.NORMAL_FILE_ALT2:case d.CONTIGUOUS_FILE:return!0;default:return!1}},e.isTarHeaderLinkIndicatorTypePax=function(e){switch(e){case d.LOCAL_EXTENDED_HEADER:case d.GLOBAL_EXTENDED_HEADER:return!0;default:return!1}},e.findNextUstarSectorOffset=function(e,r=0){if(!i.isUint8Array(e))return-1;const n=e.byteLength;let s=Math.max(0,r);for(;s<n&&!t(e,s);)s=i.advanceSectorOffset(s,n);return s<n?s:-1}}(m||(m={}));class y{constructor(e={}){this.mValueMap=y.defaultValues(),this.update(e)}static isUstarHeader(e){return!!(e&&e instanceof y)}static fromAttributes(e){return y.isUstarHeader(e)?e:new y(e)}static serializeAttributes(e){return y.fromAttributes(e).toUint8Array()}static deserialize(e,t=0){if(!m.isUstarSector(e,t))return null;const r={};for(const i of m.ALL_FIELDS)r[i.name]=i.readFrom(e,t);return new y(r)}static defaultValues(){return{fileName:"",fileMode:r.FILE_MODE_DEFAULT,groupUserId:0,ownerUserId:0,fileSize:0,lastModified:i.getUstarTimestamp(),headerChecksum:0,linkedFileName:"",typeFlag:d.NORMAL_FILE,ustarIndicator:r.USTAR_INDICATOR_VALUE,ustarVersion:r.USTAR_VERSION_VALUE,ownerUserName:"",ownerGroupName:"",deviceMajorNumber:"00",deviceMinorNumber:"00",fileNamePrefix:""}}get fileName(){return this.mValueMap.fileName}set fileName(e){this.mValueMap.fileName=e}get fileMode(){return this.mValueMap.fileMode}set fileMode(e){this.mValueMap.fileMode=e}get ownerUserId(){return this.mValueMap.ownerUserId}set ownerUserId(e){this.mValueMap.ownerUserId=e}get groupUserId(){return this.mValueMap.groupUserId}set groupUserId(e){this.mValueMap.groupUserId=e}get fileSize(){return this.mValueMap.fileSize}set fileSize(e){this.mValueMap.fileSize=e}get lastModified(){return this.mValueMap.lastModified}set lastModified(e){this.mValueMap.lastModified=i.sanitizeDateTimeAsUstar(e)}get headerChecksum(){return this.mValueMap.headerChecksum}set headerChecksum(e){this.mValueMap.headerChecksum=e}get linkedFileName(){return this.mValueMap.linkedFileName}set linkedFileName(e){this.mValueMap.linkedFileName=e}get typeFlag(){return this.mValueMap.typeFlag}set typeFlag(e){this.mValueMap.typeFlag=e}get ustarIndicator(){return this.mValueMap.ustarIndicator}get ustarVersion(){return this.mValueMap.ustarVersion}set ustarVersion(e){this.mValueMap.ustarVersion=e}get ownerUserName(){return this.mValueMap.ownerUserName}set ownerUserName(e){this.mValueMap.ownerUserName=e}get ownerGroupName(){return this.mValueMap.ownerGroupName}set ownerGroupName(e){this.mValueMap.ownerGroupName=e}get deviceMajorNumber(){return this.mValueMap.deviceMajorNumber}set deviceMajorNumber(e){this.mValueMap.deviceMajorNumber=e}get deviceMinorNumber(){return this.mValueMap.deviceMinorNumber}set deviceMinorNumber(e){this.mValueMap.deviceMinorNumber=e}get fileNamePrefix(){return this.mValueMap.fileNamePrefix}set fileNamePrefix(e){this.mValueMap.fileNamePrefix=e}get isPaxHeader(){return this.isLocalPaxHeader||this.isGlobalPaxHeader}get isGlobalPaxHeader(){return this.typeFlag===d.GLOBAL_EXTENDED_HEADER}get isLocalPaxHeader(){return this.typeFlag===d.LOCAL_EXTENDED_HEADER}get isFileHeader(){return m.isTarHeaderLinkIndicatorTypeFile(this.typeFlag)}get isDirectoryHeader(){return m.isTarHeaderLinkIndicatorTypeDirectory(this.typeFlag)}update(e){return Object.assign(this.mValueMap,e),this}toAttributes(){return Object.assign({},this.mValueMap)}toUint8Array(){const e=new Uint8Array(r.HEADER_SIZE);let t=m.CHECKSUM_SEED;for(const r of m.CHECKSUM_FIELDS)r.writeTo(e,0,this.mValueMap[r.name]),t+=r.calculateChecksum(e);return this.headerChecksum=t,E.headerChecksum.writeTo(e,0,t),e}toJSON(){const e=this.toAttributes(),t=this.toUint8Array();return{attributes:e,buffer:i.getDebugBufferJson(t)}}}class I{constructor(e){const{ustar:t,pax:r,preamble:i,isPaxGlobal:n}=e;this.ustar=t,this.pax=r,this.mPreamble=i,this.mIsGlobal=!!n,this.trySyncPaxHeader()}static isTarHeader(e){return!!(e&&e instanceof I)}static fromAttributes(e){if(I.isTarHeader(e))return e;const t=new y(e),r=I.collectPaxRequiredAttributes(e);let i;if(r){const[e,n]=I.splitBaseFileName(r.path);t.fileName=n,t.fileNamePrefix=e,i=A.fromAttributes(r)}return new I({ustar:t,pax:i})}static serializeAttributes(e){return I.isTarHeader(e)?e.toUint8Array():I.fromAttributes(e).toUint8Array()}static collectPaxRequiredAttributes(e){if(i.isObject(e)){let t={};if(e.fileName&&e.fileName.length>E.fileName.size&&(t.path=e.fileName),Object.keys(t).length>0)return t}return null}static splitBaseFileName(e){let t=e.lastIndexOf("/");return t>=0?[e.substring(0,t),e.substring(t+1)]:(t=e.lastIndexOf("\\"),t>=0?[e.substring(0,t),e.substring(t+1)]:["",e])}get preamble(){return this.mPreamble}get fileName(){var e;return(null===(e=this.pax)||void 0===e?void 0:e.path)||this.ustar.fileName}get fileMode(){return this.ustar.fileMode}get ownerUserId(){var e;return(null===(e=this.pax)||void 0===e?void 0:e.userId)||this.ustar.ownerUserId}get groupUserId(){var e;return(null===(e=this.pax)||void 0===e?void 0:e.groupId)||this.ustar.groupUserId}get fileSize(){var e;return(null===(e=this.pax)||void 0===e?void 0:e.size)||this.ustar.fileSize}get lastModified(){var e;return(null===(e=this.pax)||void 0===e?void 0:e.lastModified)||this.ustar.lastModified}get headerChecksum(){return this.ustar.headerChecksum}get linkedFileName(){var e;return(null===(e=this.pax)||void 0===e?void 0:e.linkPath)||this.ustar.linkedFileName}get typeFlag(){return this.ustar.typeFlag}get ustarIndicator(){return this.ustar.ustarIndicator}get ustarVersion(){return this.ustar.ustarVersion}get ownerUserName(){var e;return(null===(e=this.pax)||void 0===e?void 0:e.userName)||this.ustar.ownerUserName}get ownerGroupName(){var e;return(null===(e=this.pax)||void 0===e?void 0:e.groupName)||this.ustar.ownerGroupName}get deviceMajorNumber(){return this.ustar.deviceMajorNumber}get deviceMinorNumber(){return this.ustar.deviceMinorNumber}get fileNamePrefix(){return this.ustar.fileNamePrefix}get isPaxHeader(){return this.isLocalPaxHeader||this.isGlobalPaxHeader}get isGlobalPaxHeader(){return this.isGlobalPaxPreHeader||this.isGlobalPaxPostHeader}get isLocalPaxHeader(){return this.isLocalPaxPreHeader||this.isLocalPaxPostHeader}get isGlobalPaxPreHeader(){return this.ustar.isGlobalPaxHeader}get isLocalPaxPreHeader(){return this.ustar.isLocalPaxHeader}get isGlobalPaxPostHeader(){var e,t;return null!==(t=null===(e=this.preamble)||void 0===e?void 0:e.isGlobalPaxHeader)&&void 0!==t&&t}get isLocalPaxPostHeader(){var e,t;return null!==(t=null===(e=this.preamble)||void 0===e?void 0:e.isLocalPaxHeader)&&void 0!==t&&t}get isFileHeader(){return this.ustar.isFileHeader}get isDirectoryHeader(){return this.ustar.isDirectoryHeader}clean(){var e;return null===(e=this.pax)||void 0===e||e.clean(),this}normalize(){return this.trySyncPaxHeader(),this}toUint8Array(){if(this.normalize(),!(this.isPaxHeader&&this.pax&&this.preamble))return this.ustar.toUint8Array();const e=this.preamble.toUint8Array(),t=this.pax.toUint8ArrayPadded(),r=this.ustar.toUint8Array(),i=e.byteLength+t.byteLength+r.byteLength,n=new Uint8Array(i);let s=0;return n.set(e,s),s+=e.byteLength,n.set(t,s),s+=t.byteLength,n.set(r,s),n}toJSON(){const{pax:e,preamble:t,ustar:r}=this;return{preamble:t,pax:e,ustar:r}}trySyncPaxHeader(){if(!this.pax)return;const e=this.fileName,t=this.pax.toUint8Array().byteLength,r=this.pax.lastModified,i={fileName:e,typeFlag:this.mIsGlobal?d.GLOBAL_EXTENDED_HEADER:d.LOCAL_EXTENDED_HEADER,lastModified:r,fileSize:t};this.mPreamble?this.mPreamble.update(i):this.mPreamble=new y(i)}}class _{constructor(e={}){let{header:t,headerAttributes:r,headerByteLength:n,content:s,offset:a,context:u}=e;t||(t=I.fromAttributes(r||{})),n||(n=0),s||(s=null),a||(a=0),u||(u=null);const o=i.sizeofUint8Array(s);!t.pax&&t.fileSize!==o&&o>0&&(t.ustar.fileSize=o),this.mHeader=t,this.mHeaderByteLength=n,this.mContent=s,this.mOffset=a,this.mContext=u}static isArchiveEntry(e){return!!(e&&e instanceof _)}get fileName(){return this.header.fileName}get fileSize(){return this.header.fileSize}get fileMode(){return this.header.fileMode}get ownerUserId(){return this.header.ownerUserId}get groupUserId(){return this.header.groupUserId}get lastModified(){return this.header.lastModified}get headerChecksum(){return this.header.headerChecksum}get linkedFileName(){return this.header.linkedFileName}get typeFlag(){return this.header.typeFlag}get ustarIndicator(){return this.header.ustarIndicator}get ustarVersion(){return this.header.ustarVersion}get ownerUserName(){return this.header.ownerUserName}get ownerGroupName(){return this.header.ownerGroupName}get deviceMajorNumber(){return this.header.deviceMajorNumber}get deviceMinorNumber(){return this.header.deviceMinorNumber}get fileNamePrefix(){return this.header.fileNamePrefix}get header(){return this.mHeader}get content(){return this.mContent}get sourceOffset(){return this.mOffset}get sourceHeaderByteLength(){return this.mHeaderByteLength}get sourceContext(){return this.mContext}isDirectory(){return this.header.isDirectoryHeader}isFile(){return this.header.isFileHeader}getContentAsText(){return i.decodeString(this.content)}readContentFrom(e,t=0,r=0){return(0,n.__awaiter)(this,void 0,void 0,function*(){const n=this.fileSize,s=this.sourceHeaderByteLength+this.sourceOffset,a=s+n,u=i.clamp(t,0,n)+s,o=Math.max(0,a-u),l=r>0?Math.min(r,o):o;return e.read(u,l)})}toUint8Array(){var e,t;const r=this.header.toUint8Array(),n=null!==(t=null===(e=this.content)||void 0===e?void 0:e.byteLength)&&void 0!==t?t:0,s=i.roundUpSectorOffset(r.byteLength+n),a=new Uint8Array(s);return a.set(r,0),n>0&&a.set(this.content,r.byteLength),a}toJSON(){const{header:e,fileName:t,fileSize:r,content:n}=this,s=this.isFile(),a=this.isDirectory();return{name:t,size:r,type:s?"file":a?"directory":"complex",header:e,contentType:n?"Uint8Array["+n.byteLength+"]":"null",content:i.getDebugHexString(n)}}}const N=1e5*r.SECTOR_SIZE;var S;!function(e){e.ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET="ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET="ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_HEADER_MISSING_POST_PAX_SEGMENT="ERR_HEADER_MISSING_POST_PAX_SEGMENT"}(S||(S={}));class p{constructor(e){this.bufferIterator=e,this.mGlobalPaxHeaders=[],this.mBufferCache=null,this.mOffset=0,this.mHasSyncInput=this.bufferIterator.input instanceof s}static withInput(e){return new p(new o(e))}[Symbol.asyncIterator](){return this}get source(){return this.bufferIterator.input}get globalPaxHeaders(){return this.mGlobalPaxHeaders}readAllEntries(){var e,t,r,i;return(0,n.__awaiter)(this,void 0,void 0,function*(){const s=[];try{for(var a,u=!0,o=(0,n.__asyncValues)(this);a=yield o.next(),!(e=a.done);){i=a.value,u=!1;try{const e=i;s.push(e)}finally{u=!0}}}catch(e){t={error:e}}finally{try{u||e||!(r=o.return)||(yield r.call(o))}finally{if(t)throw t.error}}return s})}next(){return(0,n.__awaiter)(this,void 0,void 0,function*(){const e=yield this.tryParseNextEntry();return null!==e?{done:!1,value:e}:{done:!0,value:null}})}clearBufferCache(){this.mBufferCache=null,this.mOffset=0}getBufferCacheSlice(e,t){return i.cloneUint8Array(this.mBufferCache,e,t)}tryRequireBufferSize(e){return(0,n.__awaiter)(this,void 0,void 0,function*(){return null!==(yield this.requireBufferSize(e))})}requireBufferSize(e){return(0,n.__awaiter)(this,void 0,void 0,function*(){for(;!this.mBufferCache||this.mBufferCache.byteLength<e;)if(!(yield this.loadNextChunk()))return this.clearBufferCache(),null;return this.mBufferCache})}loadNextChunk(){return(0,n.__awaiter)(this,void 0,void 0,function*(){const e=yield this.bufferIterator.tryNext();return!!e&&(this.mBufferCache?this.mBufferCache=i.concatUint8Arrays(this.mBufferCache,e):(this.mBufferCache=e,this.mOffset=0),!0)})}tryParseNextEntry(){return(0,n.__awaiter)(this,void 0,void 0,function*(){const e=yield this.tryParseNextHeader();if(null===e)return this.clearBufferCache(),null;const{header:t,headerOffset:n,contentOffset:s}=e,a=s-n,u=s+t.fileSize,o=n,l=i.roundUpSectorOffset(u);let f=null;if(this.mHasSyncInput&&t.fileSize>0){if(!(yield this.tryRequireBufferSize(l)))throw S.ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET;f=this.getBufferCacheSlice(s,u)}return l+r.SECTOR_SIZE<=this.mBufferCache.byteLength?(this.mBufferCache=this.getBufferCacheSlice(l),this.mOffset=0):this.mOffset=l,new _({header:t,offset:o,headerByteLength:a,content:f,context:this})})}tryParseNextHeader(){return(0,n.__awaiter)(this,void 0,void 0,function*(){if(!(yield this.tryRequireBufferSize(this.mOffset+r.HEADER_SIZE)))return null;let e=m.findNextUstarSectorOffset(this.mBufferCache,this.mOffset);for(;e<0&&this.mBufferCache.byteLength<N&&(yield this.loadNextChunk());)e=m.findNextUstarSectorOffset(this.mBufferCache,this.mOffset);if(e<0)return this.clearBufferCache(),null;let t=e,n=this.getBufferCacheSlice(t,t+r.HEADER_SIZE),s=y.deserialize(n),a=new I({ustar:s}),u=i.advanceSectorOffset(t,this.mBufferCache.byteLength);if(s.isPaxHeader){const e=u+i.roundUpSectorOffset(a.fileSize),o=e+r.HEADER_SIZE,l=a.isGlobalPaxHeader,f=s;if(!(yield this.tryRequireBufferSize(o)))throw S.ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET;const c=A.deserialize(this.mBufferCache,u);if(u=e,!m.isUstarSector(this.mBufferCache,u))throw S.ERR_HEADER_MISSING_POST_PAX_SEGMENT;t=u,n=this.getBufferCacheSlice(t,t+r.HEADER_SIZE),s=y.deserialize(n),u=i.advanceSectorOffsetUnclamped(u),a=new I({ustar:s,pax:c,preamble:f}),l&&this.mGlobalPaxHeaders.push(a)}return{header:a,headerOffset:t,contentOffset:u}})}}class T{constructor(e=[]){this.entries=e}static serialize(e){let t=r.TERMINAL_PADDING_SIZE;const i=[];for(const r of e){const e=r.toUint8Array();i.push(e),t+=e.byteLength}const n=new Uint8Array(t);let s=0;for(const e of i)n.set(e,s),s+=e.byteLength;return n}toUint8Array(){return T.serialize(this.entries)}addEntry(e){return this.entries.push(e),this}addEntryWith(e,t){return this.addEntry(new _({headerAttributes:e,content:t}))}addTextFile(e,t,r){return this.addBinaryFile(e,i.encodeString(t),r)}addBinaryFile(e,t,r={}){const i=Object.assign({fileName:e,fileSize:t.byteLength,typeFlag:d.NORMAL_FILE},r);return this.addEntryWith(i,t)}addDirectory(e,t={}){const r=Object.assign({fileName:e,typeFlag:d.DIRECTORY},t);return this.addEntryWith(r)}removeEntriesWhere(e){return this.entries=this.entries.filter(t=>!e(t)),this}cleanAllHeaders(){for(const e of this.entries)e.header.clean();return this}}class M extends T{constructor(e){super(e)}static extract(e){return(0,n.__awaiter)(this,void 0,void 0,function*(){const t=p.withInput(e),r=yield t.readAllEntries();return new M(r)})}static read(e){return p.withInput(e)}}module.exports=t}();