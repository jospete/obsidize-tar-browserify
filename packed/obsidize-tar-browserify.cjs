!function(){"use strict";var e,t,r={d:function(e,t){for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},i={};r.r(i),r.d(i,{Archive:function(){return T},ArchiveEntry:function(){return N},ArchiveReadError:function(){return S},ArchiveReader:function(){return p},ArchiveWriter:function(){return _},AsyncUint8ArrayIterator:function(){return u},Constants:function(){return e},InMemoryAsyncUint8Array:function(){return n},PaxHeader:function(){return g},PaxHeaderKey:function(){return c},PaxHeaderSegment:function(){return E},TarHeader:function(){return I},TarHeaderUtility:function(){return d},TarUtility:function(){return t},UstarHeader:function(){return A},UstarHeaderField:function(){return m},UstarHeaderFieldTransformType:function(){return f},UstarHeaderFieldType:function(){return o},UstarHeaderLinkIndicatorType:function(){return h}});class n{constructor(e){this.input=e}get byteLength(){return this.input.byteLength}read(e,t){const r=this.input.byteLength,i=Math.min(e,r),n=Math.min(i+t,r);return Promise.resolve(this.input.slice(i,n))}}!function(e){e.SECTOR_SIZE=512,e.OCTAL_RADIX=8,e.USTAR_TAG="ustar",e.USTAR_INDICATOR_VALUE=`${e.USTAR_TAG}\0`,e.USTAR_VERSION_VALUE="00",e.HEADER_SIZE=e.SECTOR_SIZE,e.FILE_MODE_DEFAULT=511,e.TERMINAL_PADDING_SIZE=2*e.SECTOR_SIZE,e.PAX_HEADER_PREFIX="PaxHeader"}(e||(e={})),function(t){function r(e){return"number"==typeof e&&!Number.isNaN(e)}function i(e){return"string"==typeof e}function n(e){return void 0===e}function s(e){return i(e)&&e.length>0}function a(e){return!!(e&&e instanceof Uint8Array)}function u(t){return(1+Math.floor(t/e.SECTOR_SIZE))*e.SECTOR_SIZE}function o(t){return Math.ceil(t/e.SECTOR_SIZE)*e.SECTOR_SIZE}function f(e){return Math.floor(h(e)/1e3)}function c(e){return 1e3*Math.floor(h(e))}function l(e){return c(f(e))}function h(e,t=10,i=0){if(r(e))return Math.floor(e);const n=parseInt(e,t);return r(n)?n:i}t.isNumber=r,t.isString=i,t.isUndefined=n,t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDefined=function(e){return!n(e)},t.isPopulatedString=s,t.isUint8Array=a,t.sizeofUint8Array=function(e){return a(e)?e.byteLength:0},t.encodeString=function(e){return s(e)?(new TextEncoder).encode(e):new Uint8Array(0)},t.decodeString=function(e){return a(e)?(new TextDecoder).decode(e):""},t.generateChecksum=function(e){return a(e)?e.reduce((e,t)=>e+t,0):0},t.clamp=function(e,t,r){return Math.max(t,Math.min(e,r))},t.advanceSectorOffset=function(e,t){return Math.min(t,u(e))},t.advanceSectorOffsetUnclamped=u,t.roundUpSectorOffset=o,t.getSectorOffsetDelta=function(e){return o(e)-e},t.parseIntOctal=function(t){return h(t,e.OCTAL_RADIX)},t.dateTimeToUstar=f,t.ustarTimeToDate=c,t.sanitizeDateTimeAsUstar=l,t.getUstarTimestamp=function(){return l(Date.now())},t.paxTimeToDate=function(e){return Math.floor(1e3*e)},t.paxTimeToUstar=function(e){return Math.floor(e)},t.getDebugHexString=function(e){return a(e)?Array.from(e).map(e=>e.toString(16).padStart(2,"0").toUpperCase()).join(" "):""},t.getDebugBufferJson=function(e){return{byteLength:e?.byteLength??0,content:t.getDebugHexString(e)}},t.removeTrailingZeros=function(e){const t=/^([^\0]*)[\0]*$/.exec(e);return t?t[1]:e},t.parseIntSafe=h,t.parseFloatSafe=function(e,t=0){if(r(e))return e;const i=parseFloat(e);return r(i)?i:t},t.cloneUint8Array=function(e,t,r){if(!a(e))return new Uint8Array(0);const i=e.slice(t,r),n=Array.from(i);return Uint8Array.from(n)},t.concatUint8Arrays=function(e,t){if(!a(t))return e;if(!a(e))return t;const r=e.byteLength,i=t.byteLength,n=new Uint8Array(r+i);return r>0&&n.set(e,0),i>0&&n.set(t,r),n}}(t||(t={}));const s=e.SECTOR_SIZE,a=1e4*e.SECTOR_SIZE;class u{constructor(r,i={}){this.mOffset=0,this.mInput=t.isUint8Array(r)?new n(r):r;let{blockSize:u}=function(t){return Object.assign({blockSize:16*e.SECTOR_SIZE},t)}(i);u=t.clamp(u,s,a),u=t.roundUpSectorOffset(u),this.blockSize=u}[Symbol.asyncIterator](){return this}get input(){return this.mInput}get byteLength(){return this.mInput.byteLength}get currentOffset(){return this.mOffset}async tryNext(){const e=await this.next();return e?.value?.buffer??null}async next(){const e=this.input,t=this.currentOffset,r=this.byteLength;if(t>=r)return{done:!0,value:null};const i=Math.min(this.blockSize,r-t),n=await e.read(t,i);return this.mOffset+=i,{done:!1,value:{source:e,buffer:n,offset:t}}}}var o,f,c,l,h,d;!function(e){e.ASCII="ASCII",e.ASCII_PADDED_END="ASCII_PADDED_END",e.INTEGER_OCTAL="INTEGER_OCTAL",e.INTEGER_OCTAL_TIMESTAMP="INTEGER_OCTAL_TIMESTAMP"}(o||(o={})),function(r){function i(r,i,n){const s=function(r,i){return t.parseIntSafe(r).toString(e.OCTAL_RADIX).padStart(i,"0").substring(0,i)}(r,Math.max(0,i-1-n.length))+n;return t.encodeString(s)}function n(e,t,r){return e.slice(r,r+t)}function s(r,i,s){const a=n(r,i,s);return t.parseIntSafe(t.decodeString(a).trim(),e.OCTAL_RADIX)}r.ASCII=Object.freeze({serialize:function(e,r){return t.encodeString(String(e).substring(0,r))},deserialize:function(e,r,i){const s=n(e,r,i);return t.decodeString(s)}}),r.ASCII_PADDED_END=Object.freeze({serialize:function(e,r){return(e=String(e)).length>r?t.encodeString(e.substring(0,r-1)+"\0"):t.encodeString(e.padEnd(r,"\0"))},deserialize:function(e,r,i){const s=n(e,r,i);return t.removeTrailingZeros(t.decodeString(s))}}),r.INTEGER_OCTAL=Object.freeze({serialize:function(e,t){return i(e,t," ")},deserialize:s}),r.INTEGER_OCTAL_TIMESTAMP=Object.freeze({serialize:function(e,r){return i(t.dateTimeToUstar(e),r,"")},deserialize:function(e,r,i){return t.ustarTimeToDate(s(e,r,i))}}),r.from=function(e){switch(e){case o.ASCII:return r.ASCII;case o.ASCII_PADDED_END:return r.ASCII_PADDED_END;case o.INTEGER_OCTAL:return r.INTEGER_OCTAL;case o.INTEGER_OCTAL_TIMESTAMP:return r.INTEGER_OCTAL_TIMESTAMP;default:return}}}(f||(f={}));class m{constructor(e){this.name=e.name,this.offset=e.offset,this.size=e.size,this.type=e.type,this.constantValue=e.constantValue||void 0,this.transform=f.from(this.type)}static frozen(e){return Object.freeze(new m(e))}static all(){return[m.fileName,m.fileMode,m.ownerUserId,m.groupUserId,m.fileSize,m.lastModified,m.headerChecksum,m.typeFlag,m.linkedFileName,m.ustarIndicator,m.ustarVersion,m.ownerUserName,m.ownerGroupName,m.deviceMajorNumber,m.deviceMinorNumber,m.fileNamePrefix]}static checksumSet(){return m.all().filter(e=>e!==m.headerChecksum)}sliceString(e,r){return t.decodeString(this.slice(e,r))}slice(e,r=0){if(!t.isUint8Array(e))return new Uint8Array(0);const i=r+this.offset,n=i+this.size;return e.slice(i,n)}deserialize(e,r=0){if(t.isUint8Array(e))return this.transform.deserialize(e,this.size,r)}serialize(e){const t=new Uint8Array(this.size),r=this.transform.serialize(e,this.size);return t.set(r,0),t}readFrom(e,t){return this.deserialize(e,t+this.offset)}writeTo(e,r,i){r=Math.max(r,0);const n=this.serialize(i),s=n.byteLength,a=r+this.offset;return!!(s>0&&t.isUint8Array(e)&&e.byteLength>=a+s)&&(e.set(n,a),!0)}calculateChecksum(e,r=0){let i=0;if(!t.isUint8Array(e))return i;const n=r+this.offset,s=n+this.size;for(let t=n;t<s;t++)i+=e[t];return i}}m.fileName=m.frozen({name:"fileName",offset:0,size:100,type:o.ASCII_PADDED_END}),m.fileMode=m.frozen({name:"fileMode",offset:100,size:8,type:o.INTEGER_OCTAL}),m.ownerUserId=m.frozen({name:"ownerUserId",offset:108,size:8,type:o.INTEGER_OCTAL}),m.groupUserId=m.frozen({name:"groupUserId",offset:116,size:8,type:o.INTEGER_OCTAL}),m.fileSize=m.frozen({name:"fileSize",offset:124,size:12,type:o.INTEGER_OCTAL}),m.lastModified=m.frozen({name:"lastModified",offset:136,size:12,type:o.INTEGER_OCTAL_TIMESTAMP}),m.headerChecksum=m.frozen({name:"headerChecksum",offset:148,size:8,type:o.INTEGER_OCTAL}),m.typeFlag=m.frozen({name:"typeFlag",offset:156,size:1,type:o.ASCII}),m.linkedFileName=m.frozen({name:"linkedFileName",offset:157,size:100,type:o.ASCII_PADDED_END}),m.ustarIndicator=m.frozen({name:"ustarIndicator",offset:257,size:6,type:o.ASCII,constantValue:e.USTAR_INDICATOR_VALUE}),m.ustarVersion=m.frozen({name:"ustarVersion",offset:263,size:2,type:o.ASCII,constantValue:e.USTAR_VERSION_VALUE}),m.ownerUserName=m.frozen({name:"ownerUserName",offset:265,size:32,type:o.ASCII_PADDED_END}),m.ownerGroupName=m.frozen({name:"ownerGroupName",offset:297,size:32,type:o.ASCII_PADDED_END}),m.deviceMajorNumber=m.frozen({name:"deviceMajorNumber",offset:329,size:8,type:o.ASCII_PADDED_END}),m.deviceMinorNumber=m.frozen({name:"deviceMinorNumber",offset:337,size:8,type:o.ASCII_PADDED_END}),m.fileNamePrefix=m.frozen({name:"fileNamePrefix",offset:345,size:155,type:o.ASCII_PADDED_END}),function(e){e.ACCESS_TIME="atime",e.CHARSET="charset",e.COMMENT="comment",e.GROUP_ID="gid",e.GROUP_NAME="gname",e.HDR_CHARSET="hdrcharset",e.LINK_PATH="linkpath",e.MODIFICATION_TIME="mtime",e.PATH="path",e.SIZE="size",e.USER_ID="uid",e.USER_NAME="uname"}(c||(c={}));class E{constructor(e="",t="",r=null){this.mKey=e,this.mValue=t,this.mBytes=r}static serialize(e,r){if(!e||!r)return new Uint8Array(0);const i=` ${e}=${r}\n`,n=i.length.toString().length;let s=i.length+n;s<s.toString().length+i.length&&(s+=1);const a=s.toString()+i;return t.encodeString(a)}static deserialize(e,r=0){if(!t.isUint8Array(e))return null;const i=E.findNextLengthEndIndex(e,r);if(i<0)return null;const n=t.decodeString(e.slice(r,i)),s=parseInt(n,10);if(isNaN(s))return null;const a=i+1,u=r+s,o=t.decodeString(e.slice(a,u)),f=o.indexOf("="),c=o.substring(0,f),l=o.substring(f+1).replace(/\n$/,""),h=t.cloneUint8Array(e,r,r+s);return new E(c,l,h)}static findNextLengthEndIndex(e,t){let r=t+1;for(;r<e.byteLength;){if(32===e[r])return r;r+=1}return-1}get key(){return this.mKey}get value(){return this.mValue}get bytes(){return this.toUint8Array()}get intValue(){const e=parseInt(this.value);return isNaN(e)?void 0:e}get floatValue(){const e=parseFloat(this.value);return isNaN(e)?void 0:e}toUint8Array(){return t.isUint8Array(this.mBytes)||(this.mBytes=E.serialize(this.key,this.value)),this.mBytes}toJSON(){const{key:e,value:r,bytes:i}=this;return{key:e,value:r,content:t.getDebugHexString(i)}}}!function(e){const t=[c.COMMENT,c.GROUP_ID,c.GROUP_NAME,c.HDR_CHARSET,c.LINK_PATH,c.MODIFICATION_TIME,c.PATH,c.SIZE,c.USER_ID,c.USER_NAME];e.isKnownHeaderKey=function(e){return t.includes(e)}}(l||(l={}));class g{constructor(e=[]){this.valueMap={};for(const t of e)this.valueMap[t.key]=t}static deserialize(e,t=0){const r=g.deserializeSegments(e,t);return new g(r)}static fromAttributes(e){const t=g.parseSegmentsFromAttributes(e);return new g(t)}static serializeAttributes(e){const t=g.parseSegmentsFromAttributes(e);return g.serializeSegments(t)}static parseSegmentsFromAttributes(e){if(!t.isObject(e))return[];const r=[];for(const[i,n]of Object.entries(e)){const e=t.isString(n)?n:String(n);r.push(new E(i,e))}return r}static serializeSegments(e){if(!Array.isArray(e)||e.length<=0)return new Uint8Array(0);let t=0,r=[];for(const i of e){const e=i.toUint8Array();r.push(e),t+=e.byteLength}const i=new Uint8Array(t);let n=0;for(const e of r)i.set(e,n),n+=e.byteLength;return i}static wrapFileName(r){if(!t.isString(r)||r.includes(e.PAX_HEADER_PREFIX))return r;let i=r.lastIndexOf("/");return i>=0?g.insertPaxAt(r,"/",i):(i=r.lastIndexOf("\\"),i>=0?g.insertPaxAt(r,"\\",i):g.makeTopLevelPrefix(r,"/",0))}static insertPaxAt(t,r,i){const n=m.fileName.size;return t.length<n?t.substring(0,i)+r+e.PAX_HEADER_PREFIX+t.substring(i):g.makeTopLevelPrefix(t,"/",i+1)}static makeTopLevelPrefix(t,r,i){const n=m.fileName.size;let s=e.PAX_HEADER_PREFIX+r+t.substring(i);return s.length>n&&(s=s.substring(0,n-2)+"\0\0"),s}static deserializeSegments(e,t){const r=[];let i=t,n=E.deserialize(e,i);for(;null!==n;)r.push(n),i+=n.bytes.byteLength,n=E.deserialize(e,i);return r}get accessTime(){return this.getFloat(c.ACCESS_TIME)}get charset(){return this.get(c.CHARSET)}get comment(){return this.get(c.COMMENT)}get groupId(){return this.getInt(c.GROUP_ID)}get groupName(){return this.get(c.GROUP_NAME)}get hdrCharset(){return this.get(c.HDR_CHARSET)}get linkPath(){return this.get(c.LINK_PATH)}get modificationTime(){return this.getFloat(c.MODIFICATION_TIME)}get path(){return this.get(c.PATH)}get size(){return this.getInt(c.SIZE)}get userId(){return this.getInt(c.USER_ID)}get userName(){return this.get(c.USER_NAME)}get lastModified(){const e=this.modificationTime;return e?t.paxTimeToDate(e):void 0}keys(){return Object.keys(this.valueMap)}values(){return Object.values(this.valueMap)}clean(){for(const e of this.keys())l.isKnownHeaderKey(e)||delete this.valueMap[e];return this}has(e){return t.isDefined(this.valueMap[e])}get(e){return this.valueMap[e]?.value}getInt(e){return this.valueMap[e]?.intValue}getFloat(e){return this.valueMap[e]?.floatValue}toUint8Array(){return g.serializeSegments(this.values())}toUint8ArrayPadded(){const e=this.toUint8Array();let r=t.getSectorOffsetDelta(e.byteLength);return r>0?t.concatUint8Arrays(e,new Uint8Array(r)):e}toJSON(){const{valueMap:e}=this,r=this.toUint8Array();return{attributes:e,buffer:t.getDebugBufferJson(r)}}}!function(e){e.UNKNOWN="UNKNOWN",e.NORMAL_FILE="0",e.NORMAL_FILE_ALT1="\0",e.NORMAL_FILE_ALT2="",e.HARD_LINK="1",e.SYMBOLIC_LINK="2",e.CHARACTER_SPECIAL="3",e.BLOCK_SPECIAL="4",e.DIRECTORY="5",e.FIFO="6",e.CONTIGUOUS_FILE="7",e.GLOBAL_EXTENDED_HEADER="g",e.LOCAL_EXTENDED_HEADER="x"}(h||(h={})),function(r){function i(t,r){return m.ustarIndicator.sliceString(t,r).startsWith(e.USTAR_TAG)}r.CHECKSUM_SEED_STRING="".padStart(m.headerChecksum.size," "),r.CHECKSUM_SEED=t.generateChecksum(t.encodeString(r.CHECKSUM_SEED_STRING)),r.ALL_FIELDS=m.all(),r.CHECKSUM_FIELDS=m.checksumSet(),r.isUstarSector=i,r.isTarHeaderLinkIndicatorTypeDirectory=function(e){return e===h.DIRECTORY},r.isTarHeaderLinkIndicatorTypeFile=function(e){switch(e){case h.NORMAL_FILE:case h.NORMAL_FILE_ALT1:case h.NORMAL_FILE_ALT2:case h.CONTIGUOUS_FILE:return!0;default:return!1}},r.isTarHeaderLinkIndicatorTypePax=function(e){switch(e){case h.LOCAL_EXTENDED_HEADER:case h.GLOBAL_EXTENDED_HEADER:return!0;default:return!1}},r.findNextUstarSectorOffset=function(e,r=0){if(!t.isUint8Array(e))return-1;const n=e.byteLength;let s=Math.max(0,r);for(;s<n&&!i(e,s);)s=t.advanceSectorOffset(s,n);return s<n?s:-1}}(d||(d={}));class A{constructor(e={}){this.mValueMap=A.defaultValues(),this.update(e)}static isUstarHeader(e){return!!(e&&e instanceof A)}static fromAttributes(e){return A.isUstarHeader(e)?e:new A(e)}static serializeAttributes(e){return A.fromAttributes(e).toUint8Array()}static deserialize(e,t=0){if(!d.isUstarSector(e,t))return null;const r={};for(const i of d.ALL_FIELDS)r[i.name]=i.readFrom(e,t);return new A(r)}static defaultValues(){return{fileName:"",fileMode:e.FILE_MODE_DEFAULT,groupUserId:0,ownerUserId:0,fileSize:0,lastModified:t.getUstarTimestamp(),headerChecksum:0,linkedFileName:"",typeFlag:h.NORMAL_FILE,ustarIndicator:e.USTAR_INDICATOR_VALUE,ustarVersion:e.USTAR_VERSION_VALUE,ownerUserName:"",ownerGroupName:"",deviceMajorNumber:"00",deviceMinorNumber:"00",fileNamePrefix:""}}get fileName(){return this.mValueMap.fileName}set fileName(e){this.mValueMap.fileName=e}get fileMode(){return this.mValueMap.fileMode}set fileMode(e){this.mValueMap.fileMode=e}get ownerUserId(){return this.mValueMap.ownerUserId}set ownerUserId(e){this.mValueMap.ownerUserId=e}get groupUserId(){return this.mValueMap.groupUserId}set groupUserId(e){this.mValueMap.groupUserId=e}get fileSize(){return this.mValueMap.fileSize}set fileSize(e){this.mValueMap.fileSize=e}get lastModified(){return this.mValueMap.lastModified}set lastModified(e){this.mValueMap.lastModified=t.sanitizeDateTimeAsUstar(e)}get headerChecksum(){return this.mValueMap.headerChecksum}set headerChecksum(e){this.mValueMap.headerChecksum=e}get linkedFileName(){return this.mValueMap.linkedFileName}set linkedFileName(e){this.mValueMap.linkedFileName=e}get typeFlag(){return this.mValueMap.typeFlag}set typeFlag(e){this.mValueMap.typeFlag=e}get ustarIndicator(){return this.mValueMap.ustarIndicator}get ustarVersion(){return this.mValueMap.ustarVersion}set ustarVersion(e){this.mValueMap.ustarVersion=e}get ownerUserName(){return this.mValueMap.ownerUserName}set ownerUserName(e){this.mValueMap.ownerUserName=e}get ownerGroupName(){return this.mValueMap.ownerGroupName}set ownerGroupName(e){this.mValueMap.ownerGroupName=e}get deviceMajorNumber(){return this.mValueMap.deviceMajorNumber}set deviceMajorNumber(e){this.mValueMap.deviceMajorNumber=e}get deviceMinorNumber(){return this.mValueMap.deviceMinorNumber}set deviceMinorNumber(e){this.mValueMap.deviceMinorNumber=e}get fileNamePrefix(){return this.mValueMap.fileNamePrefix}set fileNamePrefix(e){this.mValueMap.fileNamePrefix=e}get isPaxHeader(){return this.isLocalPaxHeader||this.isGlobalPaxHeader}get isGlobalPaxHeader(){return this.typeFlag===h.GLOBAL_EXTENDED_HEADER}get isLocalPaxHeader(){return this.typeFlag===h.LOCAL_EXTENDED_HEADER}get isFileHeader(){return d.isTarHeaderLinkIndicatorTypeFile(this.typeFlag)}get isDirectoryHeader(){return d.isTarHeaderLinkIndicatorTypeDirectory(this.typeFlag)}update(e){return Object.assign(this.mValueMap,e),this}toAttributes(){return Object.assign({},this.mValueMap)}toUint8Array(){const t=new Uint8Array(e.HEADER_SIZE);let r=d.CHECKSUM_SEED;for(const e of d.CHECKSUM_FIELDS)e.writeTo(t,0,this.mValueMap[e.name]),r+=e.calculateChecksum(t);return this.headerChecksum=r,m.headerChecksum.writeTo(t,0,r),t}toJSON(){const e=this.toAttributes(),r=this.toUint8Array();return{attributes:e,buffer:t.getDebugBufferJson(r)}}}class I{constructor(e){const{ustar:t,pax:r,preamble:i,isPaxGlobal:n}=e;this.ustar=t,this.pax=r,this.mPreamble=i,this.mIsGlobal=!!n,this.trySyncPaxHeader()}static isTarHeader(e){return!!(e&&e instanceof I)}static fromAttributes(e){if(I.isTarHeader(e))return e;const t=new A(e),r=I.collectPaxRequiredAttributes(e);let i;if(r){const[e,n]=I.splitBaseFileName(r.path);t.fileName=n,t.fileNamePrefix=e,i=g.fromAttributes(r)}return new I({ustar:t,pax:i})}static serializeAttributes(e){return I.isTarHeader(e)?e.toUint8Array():I.fromAttributes(e).toUint8Array()}static collectPaxRequiredAttributes(e){if(t.isObject(e)){let t={};if(e.fileName&&e.fileName.length>m.fileName.size&&(t.path=e.fileName),Object.keys(t).length>0)return t}return null}static splitBaseFileName(e){let t=e.lastIndexOf("/");return t>=0?[e.substring(0,t),e.substring(t+1)]:(t=e.lastIndexOf("\\"),t>=0?[e.substring(0,t),e.substring(t+1)]:["",e])}get preamble(){return this.mPreamble}get fileName(){return this.pax?.path||this.ustar.fileName}get fileMode(){return this.ustar.fileMode}get ownerUserId(){return this.pax?.userId||this.ustar.ownerUserId}get groupUserId(){return this.pax?.groupId||this.ustar.groupUserId}get fileSize(){return this.pax?.size||this.ustar.fileSize}get lastModified(){return this.pax?.lastModified||this.ustar.lastModified}get headerChecksum(){return this.ustar.headerChecksum}get linkedFileName(){return this.pax?.linkPath||this.ustar.linkedFileName}get typeFlag(){return this.ustar.typeFlag}get ustarIndicator(){return this.ustar.ustarIndicator}get ustarVersion(){return this.ustar.ustarVersion}get ownerUserName(){return this.pax?.userName||this.ustar.ownerUserName}get ownerGroupName(){return this.pax?.groupName||this.ustar.ownerGroupName}get deviceMajorNumber(){return this.ustar.deviceMajorNumber}get deviceMinorNumber(){return this.ustar.deviceMinorNumber}get fileNamePrefix(){return this.ustar.fileNamePrefix}get isPaxHeader(){return this.isLocalPaxHeader||this.isGlobalPaxHeader}get isGlobalPaxHeader(){return this.isGlobalPaxPreHeader||this.isGlobalPaxPostHeader}get isLocalPaxHeader(){return this.isLocalPaxPreHeader||this.isLocalPaxPostHeader}get isGlobalPaxPreHeader(){return this.ustar.isGlobalPaxHeader}get isLocalPaxPreHeader(){return this.ustar.isLocalPaxHeader}get isGlobalPaxPostHeader(){return this.preamble?.isGlobalPaxHeader??!1}get isLocalPaxPostHeader(){return this.preamble?.isLocalPaxHeader??!1}get isFileHeader(){return this.ustar.isFileHeader}get isDirectoryHeader(){return this.ustar.isDirectoryHeader}clean(){return this.pax?.clean(),this}normalize(){return this.trySyncPaxHeader(),this}toUint8Array(){if(this.normalize(),!(this.isPaxHeader&&this.pax&&this.preamble))return this.ustar.toUint8Array();const e=this.preamble.toUint8Array(),t=this.pax.toUint8ArrayPadded(),r=this.ustar.toUint8Array(),i=e.byteLength+t.byteLength+r.byteLength,n=new Uint8Array(i);let s=0;return n.set(e,s),s+=e.byteLength,n.set(t,s),s+=t.byteLength,n.set(r,s),n}toJSON(){const{pax:e,preamble:t,ustar:r}=this;return{preamble:t,pax:e,ustar:r}}trySyncPaxHeader(){if(!this.pax)return;const e=this.fileName,t=this.pax.toUint8Array().byteLength,r=this.pax.lastModified,i={fileName:e,typeFlag:this.mIsGlobal?h.GLOBAL_EXTENDED_HEADER:h.LOCAL_EXTENDED_HEADER,lastModified:r,fileSize:t};this.mPreamble?this.mPreamble.update(i):this.mPreamble=new A(i)}}class N{constructor(e={}){let{header:r,headerAttributes:i,headerByteLength:n,content:s,offset:a,context:u}=e;r||(r=I.fromAttributes(i||{})),s||(s=null),a||(a=0),u||(u=null);const o=t.sizeofUint8Array(s);!r.pax&&r.fileSize!==o&&o>0&&(r.ustar.fileSize=o),n||(n=r.toUint8Array().byteLength),this.mHeader=r,this.mHeaderByteLength=n,this.mContent=s,this.mOffset=a,this.mContext=u}static isArchiveEntry(e){return!!(e&&e instanceof N)}get fileName(){return this.header.fileName}get fileSize(){return this.header.fileSize}get fileMode(){return this.header.fileMode}get ownerUserId(){return this.header.ownerUserId}get groupUserId(){return this.header.groupUserId}get lastModified(){return this.header.lastModified}get headerChecksum(){return this.header.headerChecksum}get linkedFileName(){return this.header.linkedFileName}get typeFlag(){return this.header.typeFlag}get ustarIndicator(){return this.header.ustarIndicator}get ustarVersion(){return this.header.ustarVersion}get ownerUserName(){return this.header.ownerUserName}get ownerGroupName(){return this.header.ownerGroupName}get deviceMajorNumber(){return this.header.deviceMajorNumber}get deviceMinorNumber(){return this.header.deviceMinorNumber}get fileNamePrefix(){return this.header.fileNamePrefix}get header(){return this.mHeader}get content(){return this.mContent}get sourceOffset(){return this.mOffset}get sourceHeaderByteLength(){return this.mHeaderByteLength}get sourceContext(){return this.mContext}isDirectory(){return this.header.isDirectoryHeader}isFile(){return this.header.isFileHeader}text(){return t.decodeString(this.content)}async readContentFrom(e,r=0,i=0){const n=this.fileSize,s=this.sourceOffset+this.sourceHeaderByteLength,a=s+n,u=s+t.clamp(r,0,n),o=Math.max(0,a-u),f=i>0?Math.min(i,o):o;return e.read(u,f)}toUint8Array(){const e=this.header.toUint8Array(),r=this.content?.byteLength??0,i=t.roundUpSectorOffset(e.byteLength+r),n=new Uint8Array(i);return n.set(e,0),r>0&&n.set(this.content,e.byteLength),n}toJSON(){const{header:e,fileName:r,fileSize:i,content:n}=this,s=this.isFile(),a=this.isDirectory();return{name:r,size:i,type:s?"file":a?"directory":"complex",header:e,contentType:n?"Uint8Array["+n.byteLength+"]":"null",content:t.getDebugHexString(n)}}}const y=1e5*e.SECTOR_SIZE;var S;!function(e){e.ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET="ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET="ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET",e.ERR_HEADER_MISSING_POST_PAX_SEGMENT="ERR_HEADER_MISSING_POST_PAX_SEGMENT"}(S||(S={}));class p{constructor(e){this.bufferIterator=e,this.mGlobalPaxHeaders=[],this.mBufferCache=null,this.mOffset=0,this.mHasSyncInput=this.bufferIterator.input instanceof n}static withInput(e){return new p(new u(e))}[Symbol.asyncIterator](){return this}get source(){return this.bufferIterator.input}get globalPaxHeaders(){return this.mGlobalPaxHeaders}async readAllEntries(){const e=[];for await(const t of this)e.push(t);return e}async next(){const e=await this.tryParseNextEntry();return null!==e?{done:!1,value:e}:{done:!0,value:null}}clearBufferCache(){this.mBufferCache=null,this.mOffset=0}getBufferCacheSlice(e,r){return t.cloneUint8Array(this.mBufferCache,e,r)}async tryRequireBufferSize(e){return null!==await this.requireBufferSize(e)}async requireBufferSize(e){for(;!this.mBufferCache||this.mBufferCache.byteLength<e;)if(!await this.loadNextChunk())return this.clearBufferCache(),null;return this.mBufferCache}async loadNextChunk(){const e=await this.bufferIterator.tryNext();return!!e&&(this.mBufferCache?this.mBufferCache=t.concatUint8Arrays(this.mBufferCache,e):(this.mBufferCache=e,this.mOffset=0),!0)}async tryParseNextEntry(){const r=await this.tryParseNextHeader();if(null===r)return this.clearBufferCache(),null;const{header:i,headerOffset:n,contentOffset:s}=r,a=s-n,u=s+i.fileSize,o=n,f=t.roundUpSectorOffset(u);let c=null;if(this.mHasSyncInput&&i.fileSize>0){if(!await this.tryRequireBufferSize(f))throw S.ERR_ENTRY_CONTENT_MIN_BUFFER_LENGTH_NOT_MET;c=this.getBufferCacheSlice(s,u)}return f+e.SECTOR_SIZE<=this.mBufferCache.byteLength?(this.mBufferCache=this.getBufferCacheSlice(f),this.mOffset=0):this.mOffset=f,new N({header:i,offset:o,headerByteLength:a,content:c,context:this})}async tryParseNextHeader(){if(!await this.tryRequireBufferSize(this.mOffset+e.HEADER_SIZE))return null;let r=d.findNextUstarSectorOffset(this.mBufferCache,this.mOffset);for(;r<0&&this.mBufferCache.byteLength<y&&await this.loadNextChunk();)r=d.findNextUstarSectorOffset(this.mBufferCache,this.mOffset);if(r<0)return this.clearBufferCache(),null;let i=r,n=this.getBufferCacheSlice(i,i+e.HEADER_SIZE),s=A.deserialize(n),a=new I({ustar:s}),u=t.advanceSectorOffset(i,this.mBufferCache.byteLength);if(s.isPaxHeader){const r=u+t.roundUpSectorOffset(a.fileSize),o=r+e.HEADER_SIZE,f=a.isGlobalPaxHeader,c=s;if(!await this.tryRequireBufferSize(o))throw S.ERR_HEADER_PAX_MIN_BUFFER_LENGTH_NOT_MET;const l=g.deserialize(this.mBufferCache,u);if(u=r,!d.isUstarSector(this.mBufferCache,u))throw S.ERR_HEADER_MISSING_POST_PAX_SEGMENT;i=u,n=this.getBufferCacheSlice(i,i+e.HEADER_SIZE),s=A.deserialize(n),u=t.advanceSectorOffsetUnclamped(u),a=new I({ustar:s,pax:l,preamble:c}),f&&this.mGlobalPaxHeaders.push(a)}return{header:a,headerOffset:i,contentOffset:u}}}class _{constructor(e=[]){this.entries=e}static serialize(t){let r=e.TERMINAL_PADDING_SIZE;const i=[];for(const e of t){const t=e.toUint8Array();i.push(t),r+=t.byteLength}const n=new Uint8Array(r);let s=0;for(const e of i)n.set(e,s),s+=e.byteLength;return n}toUint8Array(){return _.serialize(this.entries)}addEntry(e){return this.entries.push(e),this}addEntryWith(e,t){return this.addEntry(new N({headerAttributes:e,content:t}))}addTextFile(e,r,i){return this.addBinaryFile(e,t.encodeString(r),i)}addBinaryFile(e,t,r={}){const i=Object.assign({fileName:e,fileSize:t.byteLength,typeFlag:h.NORMAL_FILE},r);return this.addEntryWith(i,t)}addDirectory(e,t={}){const r=Object.assign({fileName:e,typeFlag:h.DIRECTORY},t);return this.addEntryWith(r)}removeEntriesWhere(e){return this.entries=this.entries.filter(t=>!e(t)),this}cleanAllHeaders(){for(const e of this.entries)e.header.clean();return this}}class T extends _{constructor(e){super(e)}static async extract(e){const t=p.withInput(e),r=await t.readAllEntries();return new T(r)}static read(e){return p.withInput(e)}}module.exports=i}();